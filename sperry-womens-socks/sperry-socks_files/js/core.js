(function(){window.extole=window.extole||{};var m;m="http://origin.extole.io/type=core:clientId=1933045607:coreAssetsVersion=1499462991669".replace(/^https?:/,"");void 0===extole.DEBUG_MODE&&(extole.DEBUG_MODE=!0);void 0===extole.DEBUG_MODE&&(extole.DEBUG_MODE=!1);void 0===extole.suppressLog&&(extole.suppressLog=!1===extole.DEBUG_MODE&&"pr"==extole.env);var u="";location&&"file:"==location.protocol&&(u="http:");extole.MEDIA_SERVER=u+m;extole.CORE_ROOT="http://origin.extole.io/type=core:clientId=1933045607:coreAssetsVersion=1499462991669";
extole.VERSION="v4-1.85.7.3154-20170706";extole.MAJOR_VERSION="v4";extole.MINOR_VERSION="1.85.7.3154-20170706";extole.createZone=function(c,g){extole.require(["create-zone"],function(f){f(c,g)})};(function(c,g,f,k,b){c[g]=c[g]||{};for(c[g].q=c[g].q||[];b<k.length;)f(k[b++],c[g])})(window,"extole",function(c,g){g[c]=g[c]||function(){g.q.push([c,arguments])}},["log"],0);extole.define||function(){function c(){}function g(){var a="undefined"!==typeof opera&&"[object Opera]"===opera.toString(),d=document.createElement("script");
this.useInteractive=d.attachEvent&&!(d.attachEvent.toString&&0>d.attachEvent.toString().indexOf("[native code"))&&!a}var f=[],k=function(a){var h;d(f,function(d){if(d.url==a)return h=d,!1});return h},b=function(a){extole.log("debug","[REQUIRE] "+a)},e=function(a){extole.log("warn","[REQUIRE] "+a)},a=function(a){extole.log("error","[REQUIRE] "+a)},d=function(a,d){if(a.length)for(var h=0;h<a.length;h++)d(a[h],h);else for(h in a)a.hasOwnProperty(h)&&d(a[h],h)},h=function(a,h){var b=[];d(a,function(a,
d){b[d]=h(a,d)});return b},n=function(a){var h=a.split("/").slice(-1)[0],b=h.length;d(h.toLowerCase(),function(a){b+=" abcdefghijklmnopqrstuvwxyz1234567890-_.".indexOf(a)});return a.replace("origin","origin-"+b%8)},l=function(a){var d=!!a.match(/^extole-creatives:/),h=!!a.match(/^extole-media:/),b=!!a.match(/^core-root:\/\//),e=!!a.match(/^extole-assets:/),c=!!a.match(/origin\./),f=!!a.match(/^http:/),g=!!a.match(/^https:/);return d?(a=a.slice(17),l("extole-assets:/core-modules/"+a)):e?(a=a.slice(14),
a="extole-media:/assets/"+a,l(a)):h?(a=a.slice(13),a=extole.CORE_ROOT+a,l(a)):b?(a=a.slice(12),a=extole.CORE_ROOT+a,l(a)):c?(a=n(a),a+="?site="+window.location.hostname,l(a)):f?(a=a.slice(5),l(a)):g?(a=a.slice(6),l(a)):a};c.prototype={INITIAL_DEPENENECY_CHECK_INTERVAL:1E3,MAX_DEPENDENCY_CHECK_COUNT:3,DEPENDENCY_CHECK_INTERVAL_MULTIPLIER:2,getUnresolvedDependencies:function(){var a=[];d(this.dependencies,function(d){"$config"!=d&&(d=k(d),(!d||d&&!d._defined)&&a.push(d))});return a},getDependencies:function(){var a=
this,h=[];d(a.dependencies,function(d){d="$config"==d?a.config||null:k(d).definition||null;h.push(d)});return h},define:function(){var a=this;a.defineStartTime=a.defineStartTime||(new Date).getTime();if(!a._defining&&!a._defined&&a.dependencies)if(a._defining=!0,0<a.getUnresolvedDependencies().length)this._scheduleDependencyChecks(),a._defining=!1;else{var d=function(d){a.definedCallback=void 0;a.definition=d;a.end=(new Date).getTime();a.timeToDefine=a.end-a.start;a.timeToFetch&&b("Fetched "+a.url+
" in "+a.timeToFetch+"ms");a.isAsync&&b("Defined async "+a.url+" in "+a.timeToDefine+"ms");a._defining=!1;a._defined=!0;setTimeout(x,1)},h=a.getDependencies(),e={isAsync:!1,async:function(){e.isAsync=a.isAsync=!0;return function(a){d(a)}}};(function(){if(a.definedCallback){var b=a.definedCallback,b=b&&b.apply(e,h);e.isAsync||d(b)}else d(!0)})()}},fetch:function(){var d=this;d._fetching||d._fetched||(d.url?(d._fetching=!0,d.startFetchTime=(new Date).getTime(),q.loadModule(d.url,function(){d._fetching=
!1;d.endFetchTime=(new Date).getTime();d.timeToFetch=d.endFetchTime-d.startFetchTime;d._fetched=!0;d.define()})):a("Tried to fetch a module without a url - dependencies: "+d.dependencies+" definedCallback: "+(d.definedCallback?"exists":"null")+" config: "+d.config))},_scheduleDependencyChecks:function(){function h(n){b.dependencyCheckTimeout=setTimeout(function(){c++;var l=b.getUnresolvedDependencies();if(0!==l.length){var f=[];d(l,function(a){a._defined||f.push(a.url)});var l=n*b.DEPENDENCY_CHECK_INTERVAL_MULTIPLIER,
g=c>=b.MAX_DEPENDENCY_CHECK_COUNT,q=["Dependencies not resolved for","module:",b.url,"defineStartTime:",b.defineStartTime||null,"elapsedTime:",b.defineStartTime?(new Date).getTime()-b.defineStartTime:null,"currentlyUnresolvedDependencyUrls:",f.join(", ")];g?(q.unshift("Unable to define module in a reasonable amount of time, future dependency checks will not be scheduled."),a(q.join(" "))):e(q.join(" "));g||h(l)}},n)}var b=this,c=0;b.dependencyCheckTimeout||h(b.INITIAL_DEPENENECY_CHECK_INTERVAL)}};
g.prototype={defineQueue:[],interactiveScript:null,currentlyAddingScript:null,getInteractiveScript:function(){if(q.interactiveScript&&"interactive"==q.interactiveScript.readyState)return q.interactiveScript;for(var a=document.getElementsByTagName("head")[0].getElementsByTagName("script"),d,h=a.length-1;0<=h;h--){var e=this.getScriptDataUrl(a[h]);a[h]&&"interactive"==a[h].readyState&&e&&(d=a[h],b("...interactive script "+d.src))}return d},scriptUrlAttributeName:"data-extole-require-url",getScriptDataUrl:function(a){return a.getAttribute(this.scriptUrlAttributeName)},
setScriptDataUrl:function(a,d){a.setAttribute(this.scriptUrlAttributeName,d)},attachOnLoad:function(a,d){d=d||function(){};var h=this.useInteractive,e="PLAYSTATION 3"===navigator.platform?/^complete$/:/^(complete|loaded)$/,c=function(n){var l=a.readyState;if(h&&"interactive"==l)interactiveScript=a;else if("load"===n.type||l.match(e))h?a.detachEvent("onreadystatechange",c):a.removeEventListener("load",c,!1),b(a.src+" finished loading"),d(n)};h?a.attachEvent("onreadystatechange",c):a.addEventListener("load",
c,!1)},defineTimeout:null,addDefine:function(d){if(d.url)d.url=l(d.url);else{b("defining anonymous module...");var e=this.currentlyAddingScript||this.getInteractiveScript();this.useInteractive&&e?(e=this.getScriptDataUrl(e),b("..scriptToCompare has data url "+e),d.url=e,this.interactiveScript=null):this.useInteractive&&b("..found no scriptToCompare")}d.dependencies=h(d.dependencies,l);this.useInteractive&&!d.url&&a("defines should not be missing a url in ie.");this.defineQueue.push(d);this.defineTimeout&&
clearTimeout(this.defineTimeout);var c=this;this.defineTimeout=setTimeout(function(){b("intakeDefines from addDefine timeout");c.intakeDefines()},1)},intakeTimeout:null,intakeDefines:function(){for(var a={},h=function(d,h){a[d]=a[d]?a[d]+","+h:h},e=[],c;c=this.defineQueue.shift();){var n=[];d(c.dependencies,function(a){a&&n.push(a)});var l=c.url&&k(c.url);c.url?l?h(c.url,"updated"):h(c.url,"created"):e.push("deps "+c.dependencies);d(n,function(a){h(a,"dependency");p(a)});p(c.url,n,c.definedCallback,
c.config,c.isRequire)}var f="intakeDefines -- ";d(a,function(a,d){f+="\n - "+d+" "+a});f+="\n -- "+e.length+" anonymous modules created";d(e,function(a){f+="\n - "+a});b(f);this.intakeTimeout&&clearTimeout(this.intakeTimeout);this.intakeTimeout=setTimeout(x,1)},loadModule:function(d,h){var e=document.createElement("script");e.async=!0;e.crossOrigin="anonymous";this.setScriptDataUrl(e,d);var c=this;b("loading module "+d);this.attachOnLoad(e,function(){if(!c.useInteractive){for(var e,n=c.defineQueue.length-
1;0<=n;n--)c.defineQueue[n].url||(e&&a("Multiple anonymous modules loaded in one script - "+d),e=c.defineQueue[n]);e?(b("assigned "+d+" to anonymous module"),e.url=d):b("module url didn't define a module - "+d)}b("intake defines from loadModule");c.intakeDefines();h&&h(null)});e.src=d;this.currentlyAddingScript=e;document.getElementsByTagName("head")[0].appendChild(e);this.currentlyAddingScript=void 0}};var q=new g,x=function(){d(f,function(a){a._fetched?a._defined||a.define():a.fetch()})},p=function(a,
d,h,b,e){if("$config"!=a){var n=k(a),l=n||new c;n||f.push(l);a&&d&&(l._fetched=!0);l.start=l.start||(new Date).getTime();l.url=l.url||a;l.dependencies=l.dependencies||d;l.config=l.config||b;l.definedCallback=l.definedCallback||h;l.isRequire=l.isRequire||e}},r=function(a,d,h,b){a instanceof Array&&(b=h,h=d,d=a,a=void 0);q.addDefine({url:a,dependencies:d,definedCallback:h,config:b})};r.getModule=function(a){return k(a)};var t=0,y=function(){t++;return"anonymous_"+t};extole.define=r;extole.require=function(a,
d){q.addDefine({url:y(),dependencies:a,definedCallback:d,isRequire:!0})};extole.define("extole-require",[],function(){return{resolveUrl:l}})}();extole.define("ajax",["utils"],function(c){var g=[function(){return new XMLHttpRequest},function(){return new ActiveXObject("Msxml2.XMLHTTP")},function(){return new ActiveXObject("Msxml3.XMLHTTP")},function(){return new ActiveXObject("Microsoft.XMLHTTP")}],f=function(b){if(b=b.match(/^([a-zA-Z]*:?\/\/)?([^/]+)/))return b[2]},k=function(b,e){var a=Array.prototype.slice.call(arguments),
d=e.headers||{},h=e.xhrFields||{},n=e.url||"",l=e.data||"",g=(e.type||"get").toUpperCase(),k=e.complete||function(){},p=e.error||function(){c.log("Error with url "+n+"=",a.join(","))},r=f(n),t=f(location.toString()),r=!(r&&t&&r==t),t=location.protocol.replace(":",""),y=n.match(/^(https?)/),y=y?y[1]:t,z=t.match(/^file/);t===y||z||(n=n.replace(y,t));(r="undefined"!=typeof XDomainRequest&&r)&&(b=new XDomainRequest);c.isPlainObject(l)&&("GET"==g?(n+=c.location.serialize(l),l=null):l=JSON.stringify(l));
r?(b.open(g,n),b.onprogress=function(){},b.ontimeout=p,b.timeout=0):b.open(g,n,!0);c.extend(b,h);r||c.each(d,function(a,d){try{b.setRequestHeader(d,a)}catch(h){c.log("AJAX ERROR: Couldn't set request header",d,"to",a)}});var v=!1;b.onerror=function(a){v||(v=!0,p.call(b,b.statusText,b.status))};d=function(){void 0!==b.readyState&&4!==b.readyState||v||(v=!0,String(b.status||200).match(/^[23]/)?"function"===typeof k?k.call(b,b.responseText):c.log("`complete` callback must be a function."):p.call(b,b.statusText,
b.status))};b.onload=d;b.onreadystatechange=d;b.send(l)};return function(b){b=b||{};var e;e=!1;for(var a=0;a<g.length;a++){try{e=g[a]()}catch(d){continue}break}k(e,b);return e}});extole.define("campaigns",["utils","campaigns/api","campaigns/campaign"],function(c,g,f){return c.extend(g,{campaign:f})});extole.define("campaigns/api",["utils","configuration","campaigns/campaign","request-zone","creative-javascript-api/render/JsZone"],function(c,g,f,k,b){var e={},a=function(a){var d=a.id;d||c.throwError("campaigns",
"No id passed for campaign.",a);e[d]=a},d=function(a){return f(e[a])},h=function(a){var h;c.each(e,function(b,e){var f=d(e);if(f.wantsZone(a))return h=f.id,c.each.BREAK});if(h)return d(h);c.log("No campaign wanted zone "+a.getName()+", render cancelled")};g=g.get("CLIENT_CONFIG");c.each(g.campaigns,function(d,h){a(c.extend(d,{id:h}))});return{add:a,get:d,getByZone:h,renderZone:function(a,d){function e(a,h){var c=a.getName(),n=a.getParameters();a.campaign&&(n.campaign_id=a.campaign.id);k(c,n,function(h){h?
d(h):d(null,new b({name:c,parameters:n,element:a.element}))})}d=d||function(){};var c=h(a);c?c.renderZone(a,function(h,b){b&&b.isLegacyCreative||(h&&a.removeCampaignReferences(),e(a,d))}):(a.removeCampaignReferences(),e(a,d))}}});extole.define("campaigns/campaign",["utils","configuration","creatives","creative-javascript-api/render/JsCreativeContext"],function(c,g,f,k){var b={getConfig:function(){return g.get("CLIENT_CONFIG").campaigns[this.id]},wantsZone:function(b){var a=g.get("CLIENT_CONFIG"),
d=b.getName(),h=c.location.deserialize(location.search);return b.type&&"microsite"==b.type&&h.campaignId==this.id||b.data.campaign&&b.data.campaign==this.id||b.data.parameters&&b.data.parameters.campaign_id==this.id?!0:b.data.campaign?!1:(a=a.zone_defaults[d])&&a.campaign==this.id||b.fromUri&&this.getConfig()[b.getType()+"_creative"]?!0:!1},selectCreativeId:function(b){var a=g.get("CLIENT_CONFIG"),d=this.getConfig(),h=b.getType(),c,l=b.getData();b=a.zone_defaults[b.getName()]||{};a=a.cta_name_to_id||
{};l.cta&&(c=a[l.cta.toLowerCase()]||l.cta);c||(c=l.creative);c||(c=d[h+"_creative"]);c||(c=b.creative);return c},selectCreative:function(b,a){var d=this.selectCreativeId(b);d?f.get(d,function(h,b){var e;!h&&b&&(e=c.extend({id:d},b));a(h,e)}):a(Error("No creative id for zone "+b.getName()+" and campaign "+this.id))},renderZone:function(b,a){a=a||function(){};var d=this;b.elementReady(function(h,c){h?a(h):(b.campaign=d,d.selectCreative(b,function(d,h){if(d)a(d);else{if(h.isLegacyCreative)h.render(b);
else{var c=new k(b);h.render(c)}a(null,h)}}))})},getName:function(){return this.name?this.name:this.name=g.get("CLIENT_CONFIG").campaign_id_to_name[this.id]}};return function(e){var a=e;a.__created||(a=c.createObject(b),c.extend(a,e),a.__created=!0);return a}});(function(){var c=new Function("(function () {\n    // Paste into V4 js_source to use v5 createZone tag;\n\n\n    // Clear V4 createZone since this runs last\n    delete extole[\"createZone\"];\n\n    // V5 tag bootstrap script\n    (function (window, extole, queueUpExecution, methodNames, index) {\n        window[extole] = window[extole] || {};\n        window[extole].q = window[extole].q || [];\n        for (;index < methodNames.length;) {\n            queueUpExecution(methodNames[index++], window[extole]);\n        }\n    })(\n        window,\n        'extole',\n        function (methodName, context) {\n            context[methodName] = context[methodName] || function () {\n                context.q.push([methodName, arguments]);\n            }\n        },\n        ['createZone'],\n        0\n    );\n\n    extole.require([\n        'create-zone-implementation'\n    ], function (createZoneImplementation) {\n\n        var initializeApi = function () {\n            var api = {\n                createZone: createZoneImplementation\n            };\n            while (extole.q.length) {\n                execute(extole.q.shift());\n            }\n            extole.q.push = execute;\n            function execute(operation) {\n                if (typeof api[operation[0]] === \"function\") {\n                    api[operation[0]].apply(null, operation[1]);\n                }\n            }\n        };\n\n        initializeApi();\n\n    });\n\n    extole.define('creative-javascript-api/render/Campaign', [], function () {\n\n        function Campaign(campaignId) {\n\n            this.getId = function () {\n                return campaignId;\n            };\n\n        }\n\n        return Campaign;\n\n    });\n\n    extole.define('creative-javascript-api/render/Zone', [], function () {\n\n        function Zone(zoneName, zoneParameters, element) {\n\n            this.getElement = function () {\n                return element;\n            };\n\n            this.getName = function () {\n                return zoneName;\n            };\n\n            this.getData = function () {\n                return zoneParameters;\n            };\n\n            this.getParameters = function () {\n                return zoneParameters;\n            };\n        }\n\n        return Zone;\n\n    });\n\n    extole.define('creative-javascript-api/render/Program', [], function () {\n\n        function Program() {\n\n            var _clientProgram = extole.site;\n\n            this.getName = function () {\n                return _clientProgram.name;\n            };\n\n            this.getProgramDomain = function () {\n                return _clientProgram.program_domain;\n            };\n\n            this.getSitePatterns = function () {\n                return _clientProgram.allowed_domains;\n            };\n        }\n\n        return Program;\n\n    });\n\n    extole.define('creative-javascript-api/render/CreativeContext', [\n        'creative-javascript-api/render/Zone',\n        'creative-javascript-api/render/Campaign',\n        'creative-javascript-api/render/Program'\n    ], function (Zone, Campaign, Program) {\n\n        function CreativeContext(zoneName, zoneParameters, element, campaignId) {\n\n            var _campaign = new Campaign(campaignId);\n            var _zone = new Zone(zoneName, zoneParameters, element);\n            var _program = new Program();\n\n            this.getCampaign = function () {\n                return _campaign;\n            };\n\n            this.getZone = function () {\n                return _zone;\n            };\n\n            this.getProgram = function () {\n                return _program;\n            };\n\n        }\n\n        return CreativeContext;\n\n    });\n\n    extole.define('create-zone-implementation', [\n        'zone-targeter',\n        'request-zone-v5',\n        'find-element-by-id',\n        'http://origin.extole.io/type=core:clientId=1933045607:coreAssetsVersion=1499462991669/common/collection.js',\n        'creative-javascript-api/render/CreativeContext'\n    ], function (zoneTargeter, requestZone, findElementById, collection, CreativeContext) {\n\n        function createZoneImplementation(zoneDefinition, callback) {\n\n            callback = callback || function () {};\n\n            var zoneName = zoneDefinition.name;\n            var zoneParameters = zoneDefinition.parameters || zoneDefinition.data || {};\n            var zoneElement = zoneDefinition.element;\n            var zoneElementId = zoneDefinition.element_id;\n\n            zoneTargeter.getCreative(zoneName, zoneParameters, function (error, creative) {\n\n                var selectedCampaignId = creative ? creative.getCampaignId() : null;\n                var zoneParametersWithoutCampaignReferences = getZoneParametersWithoutCampaignReferences(zoneParameters);\n\n                executeInParallel([\n                    fireZoneRequest(),\n                    renderZone()\n                ], function (results) {\n\n                    var zoneRequestResults = results[0];\n                    var renderZoneResults = results[1];\n\n                    resolveCreateZoneCallback(zoneRequestResults, renderZoneResults);\n\n                });\n\n                function fireZoneRequest() {\n                    return function (done) {\n                        requestZone(zoneName, zoneParametersWithoutCampaignReferences, selectedCampaignId, done);\n                    };\n                }\n\n                function renderZone() {\n                    return function (done) {\n\n                        ensureElement(function (element) {\n                            var creativeContext = new CreativeContext(zoneName, zoneParametersWithoutCampaignReferences,\n                                element, selectedCampaignId);\n\n                            if (creative) {\n                                creative.render(creativeContext);\n                            }\n\n                            done(creativeContext);\n                        });\n\n                        function ensureElement(callback) {\n                            if (zoneElement) {\n                                callback(zoneElement);\n                            } else if (zoneElementId) {\n                                findElementById(zoneElementId, callback);\n                            } else {\n                                callback(createElement());\n                            }\n                        }\n\n                    };\n                }\n\n                function resolveCreateZoneCallback(zoneRequestResults, renderZoneResults) {\n\n                    var zoneRequestError = zoneRequestResults[0];\n                    var renderedCreativeContext = renderZoneResults[0];\n\n                    if (zoneRequestError) {\n                        callback(zoneRequestError);\n                        return;\n                    }\n\n                    callback(null, renderedCreativeContext.getZone());\n                }\n\n            });\n\n        }\n\n        function getZoneParametersWithoutCampaignReferences(zoneParameters) {\n            var zoneParametersWithoutCampaignReferences = collection.merge({}, zoneParameters);\n            delete zoneParametersWithoutCampaignReferences.campaign_id;\n            delete zoneParametersWithoutCampaignReferences.extole_campaign_id;\n            return zoneParametersWithoutCampaignReferences;\n        }\n\n        function executeInParallel(tasks, callback) {\n            var collectedResponses = [];\n            var requestCount = 0;\n            collection.each(tasks, function (task, index) {\n                requestCount++;\n                task(function () {\n                    requestCount--;\n                    collectedResponses[index] = arguments;\n                    if (requestCount === 0) {\n                        callback(collectedResponses);\n                    }\n                });\n            });\n        }\n\n        function createElement() {\n            return document.body.appendChild(document.createElement('DIV'));\n        }\n\n        return createZoneImplementation;\n\n    });\n\n    extole.define('campaign-step-mappings', [\n        'configuration',\n        'http://origin.extole.io/type=core:clientId=1933045607:coreAssetsVersion=1499462991669/common/collection.js'\n    ], function (configuration, collection) {\n        var CLIENT_CONFIG = configuration.get(\"CLIENT_CONFIG\");\n        var campaignStepMappings = {};\n        collection.each(CLIENT_CONFIG.campaigns, function (campaign, campaignId) {\n            collection.each(campaign, function (value, key) {\n                if (key.match(/_creative$/) && value) {\n                    var zoneName = key.replace(/_creative$/, \"\");\n                    campaignStepMappings[zoneName] = campaignStepMappings[zoneName] || [];\n                    campaignStepMappings[zoneName].push({\n                        creativeUri: value,\n                        zoneName: zoneName,\n                        campaignId: campaignId\n                    });\n                }\n            });\n        });\n        return campaignStepMappings;\n    });\n\n    extole.define('zone-targeter', [\n        'campaign-step-mappings',\n        'http://origin.extole.io/type=core:clientId=1933045607:coreAssetsVersion=1499462991669/common/uri.js',\n        'http://origin.extole.io/type=core:clientId=1933045607:coreAssetsVersion=1499462991669/common/collection.js'\n    ], function (campaignStepMappings, uri, collection) {\n\n        var zoneNameToCampaignStepMappings = campaignStepMappings\n        var queryParameters = uri.deserialize(window.location.search);\n        var extoleCampaignIdQueryParameter = queryParameters.extole_campaign_id;\n\n        function getCreative(zoneName, zoneParameters, callback) {\n\n            var campaignStepMappings = zoneNameToCampaignStepMappings[zoneName];\n\n            if (!campaignStepMappings || !campaignStepMappings.length) {\n                callback(new Error(\"no creative is mapped to zone: \" + zoneName));\n                return;\n            }\n\n            var campaignStepMapping;\n            if (zoneParameters.campaign_id) {\n                campaignStepMapping =\n                    getCampaignStepMappingByCampaignId(campaignStepMappings, zoneParameters.campaign_id);\n            }\n            if (!campaignStepMapping && zoneParameters.extole_campaign_id) {\n                campaignStepMapping =\n                    getCampaignStepMappingByCampaignId(campaignStepMappings, zoneParameters.extole_campaign_id);\n            }\n            if (!campaignStepMapping && extoleCampaignIdQueryParameter) {\n                campaignStepMapping =\n                    getCampaignStepMappingByCampaignId(campaignStepMappings, extoleCampaignIdQueryParameter);\n            }\n            if (!campaignStepMapping) {\n                campaignStepMapping = getFirstMapping(campaignStepMappings);\n            }\n\n            extole.require([campaignStepMapping.creativeUri], function (render) {\n                callback(null, new Creative(render, campaignStepMapping.campaignId));\n            });\n\n        }\n\n        function getCampaignStepMappingByCampaignId(campaignStepMappings, campaignId) {\n            for (var i = 0; i < campaignStepMappings.length; i++) {\n                if (campaignStepMappings[i].campaignId === campaignId) {\n                    return campaignStepMappings[i];\n                }\n            }\n        }\n\n        function getFirstMapping(campaignStepMappings) {\n            return campaignStepMappings[0];\n        }\n\n        function Creative(render, campaignId) {\n\n            this.render = render;\n\n            this.getCampaignId = function () {\n                return campaignId;\n            };\n\n        }\n\n        return {\n            getCreative: getCreative\n        };\n\n    });\n\n    extole.define('request-zone-v5', [\n        'http://origin.extole.io/type=core:clientId=1933045607:coreAssetsVersion=1499462991669/common/ajax.js',\n        'sites',\n        'http://origin.extole.io/type=core:clientId=1933045607:coreAssetsVersion=1499462991669/common/collection.js',\n        'http://origin.extole.io/type=core:clientId=1933045607:coreAssetsVersion=1499462991669/common/type.js'\n    ], function (ajax, sites, collection, type) {\n\n        function requestZone(zoneName, zoneData, campaignId, callback) {\n\n            callback = callback || function () {};\n\n            extole.require(['http://origin.extole.io/type=core:clientId=1933045607:coreAssetsVersion=1499462991669/common/user-service.js'], function (userService) {\n\n                userService.getUser(function (error, user) {\n\n                    if (error) {\n                        callback(error);\n                        return;\n                    }\n\n                    var zoneRequestQueryParameters = flattenKeys(zoneData);\n                    zoneRequestQueryParameters['access_token'] = user.getAccessToken();\n                    if (campaignId) {\n                        zoneRequestQueryParameters['campaign_id'] = campaignId;\n                    }\n\n                    var site = sites.getDefault();\n                    var zoneRequestUrl = \"https://\" + site.program_domain + \"/zone/\" + zoneName;\n\n                    ajax({\n                        type: \"GET\",\n                        url: zoneRequestUrl,\n                        headers: {\n                            \"Accept\": \"text/javascript\"\n                        },\n                        xhrFields: {\n                            withCredentials: true\n                        },\n                        data: zoneRequestQueryParameters,\n                        complete: function () {\n                            callback(null);\n                        },\n                        error: function (xmlHttp, statusText, status) {\n                            callback(new Error(\"zone request for zone: \" + zoneName));\n                        }\n                    });\n\n                });\n            });\n\n        }\n\n        function flattenKeys(data) {\n\n            var flattenedParameters = {};\n\n            traverse(data, []);\n\n            return flattenedParameters;\n\n            function traverse(map, parentKeys) {\n\n                if (isLeaf(map)) {\n                    var flattenedKey = parentKeys.join('.');\n                    flattenedParameters[flattenedKey] = map;\n                    return;\n                }\n\n                collection.each(map, function (value, key) {\n\n                    var parentKeysCopy = parentKeys.slice();\n                    parentKeysCopy.push(key);\n\n                    traverse(value, parentKeysCopy);\n\n                });\n\n                function isLeaf(thing) {\n                    return !type.isPlainObject(thing);\n                }\n\n            }\n\n        }\n\n        return requestZone;\n\n    });\n\n    extole.define('find-element-by-id', [], function () {\n\n        function findElementById(elementId, callback) {\n\n            var discoveredElement;\n\n            repeatUntil(defineElement, isElementFound, done);\n\n            function defineElement() {\n                discoveredElement = document.getElementById(elementId);\n            }\n\n            function isElementFound()  {\n                return Boolean(discoveredElement);\n            }\n\n            function done() {\n                callback(discoveredElement);\n            }\n\n        }\n\n        function repeatUntil(method, test, done) {\n\n            var START_INTERVAL = 10;\n            var MAX_INTERVAL = 500;\n            var INTERVAL_INCREASE_RATE = 1.1;\n            var currentInterval;\n\n            poll();\n\n            function poll() {\n                if (test()) {\n                    done();\n                    return;\n                }\n\n                method();\n                setTimeout(poll, getNextInterval());\n            }\n\n            function getNextInterval() {\n                if (!currentInterval) {\n                    currentInterval = START_INTERVAL;\n                }\n                if (currentInterval > MAX_INTERVAL) {\n                    return MAX_INTERVAL;\n                }\n                currentInterval *= INTERVAL_INCREASE_RATE;\n                return currentInterval;\n            }\n        }\n\n        return findElementById;\n\n    });\n\n})();");
try{c()}catch(g){extole.require(["http://origin.extole.io/type=core:clientId=1933045607:coreAssetsVersion=1499462991669/common/logger.js"],function(c){c.error("Error executing extended core javascript. Message : "+g.message+" Stack: "+g.stack)})}})();extole.require("utils configuration campaigns zones params events page-scanner sites user services http://origin.extole.io/type=core:clientId=1933045607:coreAssetsVersion=1499462991669/common/logger.js".split(" "),function(c,g,f,k,b,e,a,d,h,n,l){f=g.get("CLIENT_CONFIG");
g.set("PUBLISHED_DATE",f.published_date||"now");extole.user=h;extole.services=n;extole.events=e;extole.config=f;extole.site=d.getDefault();var q=function(){a.whenYouFind('script[type="extole/conversion"]').thenCall(function(a){if(!a.hasBeenUsed){a.hasBeenUsed=!0;a:{var d={};try{d=JSON.parse(a.innerHTML)}catch(h){c.log.error("Could not fire conversion. "+h);break a}a=d.type||d.event_type;d=c.extend(!0,{},g.utils.getSharedVars(),d);extole.services.zoneConvert({type:a,parameters:d.params})}}}).andRemove();
a.findAllTheThings()},x=function(){var a;"function"===typeof window.onerror&&(a=window.onerror);window.onerror=function(d,h,b,c,e){if(a)try{a(d,h,b,c,e)}catch(n){}var l={MESSAGE:d,SOURCE:h,LINE_NUMBER:b,COLUMN_NUMBER:c,STACK_TRACE:e&&e.stack?e.stack:void 0};JSON.stringify(l).match(/extole/i)&&extole.require(["http://origin.extole.io/type=core:clientId=1933045607:coreAssetsVersion=1499462991669/common/logger.js"],function(a){a.error("Unhandled exception",l)})}};d=function(){x();k.requester.start();
q();if("undefined"!==typeof window.extoleEvents)e.on(window.extoleEvents);extole._bootstrapped=!0};extole.bootstrap=d;extole.loadCoreAsLibrary||extole._bootstrapped||d();if("undefined"!==typeof window.extoleAsyncInit)try{extoleAsyncInit()}catch(p){extole.require(["http://origin.extole.io/type=core:clientId=1933045607:coreAssetsVersion=1499462991669/common/logger.js"],function(a){a.error("Error executing extended core javascript. Message : "+p.message+" Stack: "+p.stack)})}});extole.SYSTEM_DOWN=!1;
extole.CLIENT_ID="1933045607";extole.CLIENT_CONFIG={client:{client_id:"1933045607",disabled:!1,sites:[{id:"72543d890792ce740fc6f181",name:"Sperry Referral Program",program_domain:"refer.sperry.com",lazy_load:!1,cloudsponge_keys:{"refer.sperry.com":"YBYGG5VTHTXU47XYQ725","www.sperry.com":"YXG45XVQAS4UFF5B2HRM"},share_url:"http://refer.sperry.com/s",privacy_policy_url:"http://www.sperry.com/en/content?caid=privacy-policy",allowed_domains:"refer.sperry.com *-wwwinc.demandware.net *.extole.com api.extole.com *.extole.io www.sperry.com refer.sperry.com *.sperry.com".split(" ")}]},
cta_creative_name_to_id:{},campaign_name_to_id:{},zones:{registration:{id:null,name:"registration",disabled:!1,default_type:"none",default_types:{size:{},none:"none",html:""},whitelist:".*",blacklist:"",reference_element:null,resources:{}},advocate_welcome_email:{id:null,name:"advocate_welcome_email",disabled:!1,default_type:"none",default_types:{size:{},none:"none",html:""},whitelist:".*",blacklist:"",reference_element:null,resources:{}},terms:{id:null,name:"terms",disabled:!1,default_type:"none",
default_types:{size:{},none:"none",html:""},whitelist:".*",blacklist:"",reference_element:null,resources:{}},friend_cta_email:{id:null,name:"friend_cta_email",disabled:!1,default_type:"none",default_types:{size:{},none:"none",html:""},whitelist:".*",blacklist:"",reference_element:null,resources:{}},share_destination_facebook:{id:null,name:"share_destination_facebook",disabled:!1,default_type:"none",default_types:{size:{},none:"none",html:""},whitelist:".*",blacklist:"",reference_element:null,resources:{}},
advocate_widget:{id:null,name:"advocate_widget",disabled:!1,default_type:"none",default_types:{size:{},none:"none",html:""},whitelist:".*",blacklist:"",reference_element:null,resources:{}},share_destination:{id:null,name:"share_destination",disabled:!1,default_type:"none",default_types:{size:{},none:"none",html:""},whitelist:".*",blacklist:"",reference_element:null,resources:{}},advocate_earned_reward_email:{id:null,name:"advocate_earned_reward_email",disabled:!1,default_type:"none",default_types:{size:{},
none:"none",html:""},whitelist:".*",blacklist:"",reference_element:null,resources:{}},godaddy_verification:{id:null,name:"godaddy_verification",disabled:!1,default_type:"none",default_types:{size:{},none:"none",html:""},whitelist:".*",blacklist:"",reference_element:null,resources:{}},campaign_image:{id:null,name:"campaign_image",disabled:!1,default_type:"none",default_types:{size:{},none:"none",html:""},whitelist:".*",blacklist:"",reference_element:null,resources:{}},conversion:{id:null,name:"conversion",
disabled:!1,default_type:"none",default_types:{size:{},none:"none",html:""},whitelist:".*",blacklist:"",reference_element:null,resources:{}},promote_destination:{id:null,name:"promote_destination",disabled:!1,default_type:"none",default_types:{size:{},none:"none",html:""},whitelist:".*",blacklist:"",reference_element:null,resources:{}},advocate_dashboard_email:{id:null,name:"advocate_dashboard_email",disabled:!1,default_type:"none",default_types:{size:{},none:"none",html:""},whitelist:".*",blacklist:"",
reference_element:null,resources:{}},advocate_widget_embedded:{id:null,name:"advocate_widget_embedded",disabled:!1,default_type:"none",default_types:{size:{},none:"none",html:""},whitelist:".*",blacklist:"",reference_element:null,resources:{}},failing_experience:{id:null,name:"failing_experience",disabled:!1,default_type:"none",default_types:{size:{},none:"none",html:""},whitelist:".*",blacklist:"",reference_element:null,resources:{}},friend_landing_coupon:{id:null,name:"friend_landing_coupon",disabled:!1,
default_type:"none",default_types:{size:{},none:"none",html:""},whitelist:".*",blacklist:"",reference_element:null,resources:{}},order_confirmation:{id:null,name:"order_confirmation",disabled:!1,default_type:"none",default_types:{size:{},none:"none",html:""},whitelist:".*",blacklist:"",reference_element:null,resources:{}},microsite:{id:null,name:"microsite",disabled:!1,default_type:"none",default_types:{size:{},none:"none",html:""},whitelist:".*",blacklist:"",reference_element:null,resources:{}},
advocate_widget_adv:{id:null,name:"advocate_widget_adv",disabled:!1,default_type:"none",default_types:{size:{},none:"none",html:""},whitelist:".*",blacklist:"",reference_element:null,resources:{}}},zone_defaults:{registration:{creative:null,campaign:"6295715336492158421"},advocate_welcome_email:{creative:"http://origin.extole.io/type=creativeArchive:creativeArchiveId=6304305237281518589:version=284:coreAssetsVersion=1499462991669/render-javascript.js",campaign:"6288242214050308958"},terms:{creative:"http://origin.extole.io/type=creativeArchive:creativeArchiveId=6345129523765932605:version=181:coreAssetsVersion=1499462991669/render-javascript.js",
campaign:"6288242214050308958"},friend_cta_email:{creative:"http://origin.extole.io/type=creativeArchive:creativeArchiveId=6373384392986579334:version=93:coreAssetsVersion=1499462991669/render-javascript.js",campaign:"6288242214050308958"},share_destination_facebook:{creative:"http://origin.extole.io/type=creativeArchive:creativeArchiveId=6288242221195413501:version=394:coreAssetsVersion=1499462991669/render-javascript.js",campaign:"6288242214050308958"},advocate_widget:{creative:"http://origin.extole.io/type=creativeArchive:creativeArchiveId=6395620604484768625:version=48:coreAssetsVersion=1499462991669/render-javascript.js",
campaign:"6288242214050308958"},share_destination:{creative:"http://origin.extole.io/type=creativeArchive:creativeArchiveId=6295715337728957725:version=51:coreAssetsVersion=1499462991669/render-javascript.js",campaign:"6295715336492158421"},advocate_earned_reward_email:{creative:"http://origin.extole.io/type=creativeArchive:creativeArchiveId=6345159790758507600:version=154:coreAssetsVersion=1499462991669/render-javascript.js",campaign:"6288242214050308958"},godaddy_verification:{creative:"http://origin.extole.io/type=creativeArchive:creativeArchiveId=6410069281258060121:version=4:coreAssetsVersion=1499462991669/render-javascript.js",
campaign:"6267698049659706755"},campaign_image:{creative:"http://origin.extole.io/type=creativeArchive:creativeArchiveId=6429501864105813326:version=2:coreAssetsVersion=1499462991669/render-javascript.js",campaign:"6295715336492158421"},conversion:{creative:null,campaign:"6288242214050308958"},promote_destination:{creative:"http://origin.extole.io/type=creativeArchive:creativeArchiveId=6377368898043510011:version=85:coreAssetsVersion=1499462991669/render-javascript.js",campaign:"6288242214050308958"},
advocate_dashboard_email:{creative:"http://origin.extole.io/type=creativeArchive:creativeArchiveId=6328282855292269535:version=215:coreAssetsVersion=1499462991669/render-javascript.js",campaign:"6288242214050308958"},advocate_widget_embedded:{creative:"http://origin.extole.io/type=creativeArchive:creativeArchiveId=6352654716867654283:version=124:coreAssetsVersion=1499462991669/render-javascript.js",campaign:"6288242214050308958"},failing_experience:{creative:"http://origin.extole.io/type=creativeArchive:creativeArchiveId=6354428053674314185:version=110:coreAssetsVersion=1499462991669/render-javascript.js",
campaign:"6288242214050308958"},friend_landing_coupon:{creative:"http://origin.extole.io/type=creativeArchive:creativeArchiveId=6288438242692897139:version=374:coreAssetsVersion=1499462991669/render-javascript.js",campaign:"6288242214050308958"},order_confirmation:{creative:"http://origin.extole.io/type=creativeArchive:creativeArchiveId=6319853604658442313:version=245:coreAssetsVersion=1499462991669/render-javascript.js",campaign:"6288242214050308958"},microsite:{creative:"http://origin.extole.io/type=creativeArchive:creativeArchiveId=6288242217230148760:version=394:coreAssetsVersion=1499462991669/render-javascript.js",
campaign:"6288242214050308958"},advocate_widget_adv:{creative:"http://origin.extole.io/type=creativeArchive:creativeArchiveId=6295715339053470930:version=51:coreAssetsVersion=1499462991669/render-javascript.js",campaign:"6295715336492158421"}},campaigns:{"6267698049659706755":{id:"6267698049659706755",name:"unknown",registration_creative:null,advocate_welcome_email_creative:"http://origin.extole.io/type=creativeArchive:creativeArchiveId=6278687829901046797:version=96:coreAssetsVersion=1499462991669/render-javascript.js",
terms_creative:null,friend_cta_email_creative:"http://origin.extole.io/type=creativeArchive:creativeArchiveId=6373384330878546441:version=15:coreAssetsVersion=1499462991669/render-javascript.js",share_destination_facebook_creative:"http://origin.extole.io/type=creativeArchive:creativeArchiveId=6267698053280090850:version=234:coreAssetsVersion=1499462991669/render-javascript.js",advocate_widget_creative:"http://origin.extole.io/type=creativeArchive:creativeArchiveId=6276072392545681368:version=120:coreAssetsVersion=1499462991669/render-javascript.js",
share_destination_creative:"http://origin.extole.io/type=creativeArchive:creativeArchiveId=6280062462230391221:version=89:coreAssetsVersion=1499462991669/render-javascript.js",advocate_earned_reward_email_creative:"http://origin.extole.io/type=creativeArchive:creativeArchiveId=6278688623290390032:version=94:coreAssetsVersion=1499462991669/render-javascript.js",godaddy_verification_creative:"http://origin.extole.io/type=creativeArchive:creativeArchiveId=6410069281258060121:version=4:coreAssetsVersion=1499462991669/render-javascript.js",
campaign_image_creative:"http://origin.extole.io/type=creativeArchive:creativeArchiveId=6429501794595007348:version=2:coreAssetsVersion=1499462991669/render-javascript.js",conversion_creative:null},"6280338042553682676":{id:"6280338042553682676",name:"unknown",share_destination_creative:"http://origin.extole.io/type=creativeArchive:creativeArchiveId=6281659493633659357:version=148:coreAssetsVersion=1499462991669/render-javascript.js",terms_creative:"http://origin.extole.io/type=creativeArchive:creativeArchiveId=6308733897725843206:version=13:coreAssetsVersion=1499462991669/render-javascript.js",
registration_creative:null,campaign_image_creative:"http://origin.extole.io/type=creativeArchive:creativeArchiveId=6280338039786920318:version=188:coreAssetsVersion=1499462991669/render-javascript.js",advocate_earned_reward_email_creative:"http://origin.extole.io/type=creativeArchive:creativeArchiveId=6302421033523783337:version=20:coreAssetsVersion=1499462991669/render-javascript.js",share_destination_facebook_creative:"http://origin.extole.io/type=creativeArchive:creativeArchiveId=6280339009377552433:version=178:coreAssetsVersion=1499462991669/render-javascript.js",
friend_cta_email_creative:"http://origin.extole.io/type=creativeArchive:creativeArchiveId=6373384357261914013:version=2:coreAssetsVersion=1499462991669/render-javascript.js",conversion_creative:null,advocate_welcome_email_creative:"http://origin.extole.io/type=creativeArchive:creativeArchiveId=6280338630822598236:version=184:coreAssetsVersion=1499462991669/render-javascript.js"},"6288242214050308958":{id:"6288242214050308958",name:"unknown",terms_creative:"http://origin.extole.io/type=creativeArchive:creativeArchiveId=6345129523765932605:version=181:coreAssetsVersion=1499462991669/render-javascript.js",
advocate_welcome_email_creative:"http://origin.extole.io/type=creativeArchive:creativeArchiveId=6304305237281518589:version=284:coreAssetsVersion=1499462991669/render-javascript.js",promote_destination_creative:"http://origin.extole.io/type=creativeArchive:creativeArchiveId=6377368898043510011:version=85:coreAssetsVersion=1499462991669/render-javascript.js",advocate_dashboard_email_creative:"http://origin.extole.io/type=creativeArchive:creativeArchiveId=6328282855292269535:version=215:coreAssetsVersion=1499462991669/render-javascript.js",
advocate_widget_embedded_creative:"http://origin.extole.io/type=creativeArchive:creativeArchiveId=6352654716867654283:version=124:coreAssetsVersion=1499462991669/render-javascript.js",share_destination_creative:"http://origin.extole.io/type=creativeArchive:creativeArchiveId=6377368825835990604:version=86:coreAssetsVersion=1499462991669/render-javascript.js",failing_experience_creative:"http://origin.extole.io/type=creativeArchive:creativeArchiveId=6354428053674314185:version=110:coreAssetsVersion=1499462991669/render-javascript.js",
friend_cta_email_creative:"http://origin.extole.io/type=creativeArchive:creativeArchiveId=6373384392986579334:version=93:coreAssetsVersion=1499462991669/render-javascript.js",share_destination_facebook_creative:"http://origin.extole.io/type=creativeArchive:creativeArchiveId=6288242221195413501:version=394:coreAssetsVersion=1499462991669/render-javascript.js",friend_landing_coupon_creative:"http://origin.extole.io/type=creativeArchive:creativeArchiveId=6288438242692897139:version=374:coreAssetsVersion=1499462991669/render-javascript.js",
advocate_widget_creative:"http://origin.extole.io/type=creativeArchive:creativeArchiveId=6395620604484768625:version=48:coreAssetsVersion=1499462991669/render-javascript.js",campaign_image_creative:"http://origin.extole.io/type=creativeArchive:creativeArchiveId=6429501832559404627:version=34:coreAssetsVersion=1499462991669/render-javascript.js",registration_creative:null,advocate_earned_reward_email_creative:"http://origin.extole.io/type=creativeArchive:creativeArchiveId=6345159790758507600:version=154:coreAssetsVersion=1499462991669/render-javascript.js",
conversion_creative:null,order_confirmation_creative:"http://origin.extole.io/type=creativeArchive:creativeArchiveId=6319853604658442313:version=245:coreAssetsVersion=1499462991669/render-javascript.js",microsite_creative:"http://origin.extole.io/type=creativeArchive:creativeArchiveId=6288242217230148760:version=394:coreAssetsVersion=1499462991669/render-javascript.js"},"6295715336492158421":{id:"6295715336492158421",name:"unknown",share_destination_creative:"http://origin.extole.io/type=creativeArchive:creativeArchiveId=6295715337728957725:version=51:coreAssetsVersion=1499462991669/render-javascript.js",
campaign_image_creative:"http://origin.extole.io/type=creativeArchive:creativeArchiveId=6429501864105813326:version=2:coreAssetsVersion=1499462991669/render-javascript.js",registration_creative:null,advocate_widget_adv_creative:"http://origin.extole.io/type=creativeArchive:creativeArchiveId=6295715339053470930:version=51:coreAssetsVersion=1499462991669/render-javascript.js"}},js_source:"(function () {\n    // Paste into V4 js_source to use v5 createZone tag;\n\n\n    // Clear V4 createZone since this runs last\n    delete extole[\"createZone\"];\n\n    // V5 tag bootstrap script\n    (function (window, extole, queueUpExecution, methodNames, index) {\n        window[extole] = window[extole] || {};\n        window[extole].q = window[extole].q || [];\n        for (;index < methodNames.length;) {\n            queueUpExecution(methodNames[index++], window[extole]);\n        }\n    })(\n        window,\n        'extole',\n        function (methodName, context) {\n            context[methodName] = context[methodName] || function () {\n                context.q.push([methodName, arguments]);\n            }\n        },\n        ['createZone'],\n        0\n    );\n\n    extole.require([\n        'create-zone-implementation'\n    ], function (createZoneImplementation) {\n\n        var initializeApi = function () {\n            var api = {\n                createZone: createZoneImplementation\n            };\n            while (extole.q.length) {\n                execute(extole.q.shift());\n            }\n            extole.q.push = execute;\n            function execute(operation) {\n                if (typeof api[operation[0]] === \"function\") {\n                    api[operation[0]].apply(null, operation[1]);\n                }\n            }\n        };\n\n        initializeApi();\n\n    });\n\n    extole.define('creative-javascript-api/render/Campaign', [], function () {\n\n        function Campaign(campaignId) {\n\n            this.getId = function () {\n                return campaignId;\n            };\n\n        }\n\n        return Campaign;\n\n    });\n\n    extole.define('creative-javascript-api/render/Zone', [], function () {\n\n        function Zone(zoneName, zoneParameters, element) {\n\n            this.getElement = function () {\n                return element;\n            };\n\n            this.getName = function () {\n                return zoneName;\n            };\n\n            this.getData = function () {\n                return zoneParameters;\n            };\n\n            this.getParameters = function () {\n                return zoneParameters;\n            };\n        }\n\n        return Zone;\n\n    });\n\n    extole.define('creative-javascript-api/render/Program', [], function () {\n\n        function Program() {\n\n            var _clientProgram = extole.site;\n\n            this.getName = function () {\n                return _clientProgram.name;\n            };\n\n            this.getProgramDomain = function () {\n                return _clientProgram.program_domain;\n            };\n\n            this.getSitePatterns = function () {\n                return _clientProgram.allowed_domains;\n            };\n        }\n\n        return Program;\n\n    });\n\n    extole.define('creative-javascript-api/render/CreativeContext', [\n        'creative-javascript-api/render/Zone',\n        'creative-javascript-api/render/Campaign',\n        'creative-javascript-api/render/Program'\n    ], function (Zone, Campaign, Program) {\n\n        function CreativeContext(zoneName, zoneParameters, element, campaignId) {\n\n            var _campaign = new Campaign(campaignId);\n            var _zone = new Zone(zoneName, zoneParameters, element);\n            var _program = new Program();\n\n            this.getCampaign = function () {\n                return _campaign;\n            };\n\n            this.getZone = function () {\n                return _zone;\n            };\n\n            this.getProgram = function () {\n                return _program;\n            };\n\n        }\n\n        return CreativeContext;\n\n    });\n\n    extole.define('create-zone-implementation', [\n        'zone-targeter',\n        'request-zone-v5',\n        'find-element-by-id',\n        'http://origin.extole.io/type=core:clientId=1933045607:coreAssetsVersion=1499462991669/common/collection.js',\n        'creative-javascript-api/render/CreativeContext'\n    ], function (zoneTargeter, requestZone, findElementById, collection, CreativeContext) {\n\n        function createZoneImplementation(zoneDefinition, callback) {\n\n            callback = callback || function () {};\n\n            var zoneName = zoneDefinition.name;\n            var zoneParameters = zoneDefinition.parameters || zoneDefinition.data || {};\n            var zoneElement = zoneDefinition.element;\n            var zoneElementId = zoneDefinition.element_id;\n\n            zoneTargeter.getCreative(zoneName, zoneParameters, function (error, creative) {\n\n                var selectedCampaignId = creative ? creative.getCampaignId() : null;\n                var zoneParametersWithoutCampaignReferences = getZoneParametersWithoutCampaignReferences(zoneParameters);\n\n                executeInParallel([\n                    fireZoneRequest(),\n                    renderZone()\n                ], function (results) {\n\n                    var zoneRequestResults = results[0];\n                    var renderZoneResults = results[1];\n\n                    resolveCreateZoneCallback(zoneRequestResults, renderZoneResults);\n\n                });\n\n                function fireZoneRequest() {\n                    return function (done) {\n                        requestZone(zoneName, zoneParametersWithoutCampaignReferences, selectedCampaignId, done);\n                    };\n                }\n\n                function renderZone() {\n                    return function (done) {\n\n                        ensureElement(function (element) {\n                            var creativeContext = new CreativeContext(zoneName, zoneParametersWithoutCampaignReferences,\n                                element, selectedCampaignId);\n\n                            if (creative) {\n                                creative.render(creativeContext);\n                            }\n\n                            done(creativeContext);\n                        });\n\n                        function ensureElement(callback) {\n                            if (zoneElement) {\n                                callback(zoneElement);\n                            } else if (zoneElementId) {\n                                findElementById(zoneElementId, callback);\n                            } else {\n                                callback(createElement());\n                            }\n                        }\n\n                    };\n                }\n\n                function resolveCreateZoneCallback(zoneRequestResults, renderZoneResults) {\n\n                    var zoneRequestError = zoneRequestResults[0];\n                    var renderedCreativeContext = renderZoneResults[0];\n\n                    if (zoneRequestError) {\n                        callback(zoneRequestError);\n                        return;\n                    }\n\n                    callback(null, renderedCreativeContext.getZone());\n                }\n\n            });\n\n        }\n\n        function getZoneParametersWithoutCampaignReferences(zoneParameters) {\n            var zoneParametersWithoutCampaignReferences = collection.merge({}, zoneParameters);\n            delete zoneParametersWithoutCampaignReferences.campaign_id;\n            delete zoneParametersWithoutCampaignReferences.extole_campaign_id;\n            return zoneParametersWithoutCampaignReferences;\n        }\n\n        function executeInParallel(tasks, callback) {\n            var collectedResponses = [];\n            var requestCount = 0;\n            collection.each(tasks, function (task, index) {\n                requestCount++;\n                task(function () {\n                    requestCount--;\n                    collectedResponses[index] = arguments;\n                    if (requestCount === 0) {\n                        callback(collectedResponses);\n                    }\n                });\n            });\n        }\n\n        function createElement() {\n            return document.body.appendChild(document.createElement('DIV'));\n        }\n\n        return createZoneImplementation;\n\n    });\n\n    extole.define('campaign-step-mappings', [\n        'configuration',\n        'http://origin.extole.io/type=core:clientId=1933045607:coreAssetsVersion=1499462991669/common/collection.js'\n    ], function (configuration, collection) {\n        var CLIENT_CONFIG = configuration.get(\"CLIENT_CONFIG\");\n        var campaignStepMappings = {};\n        collection.each(CLIENT_CONFIG.campaigns, function (campaign, campaignId) {\n            collection.each(campaign, function (value, key) {\n                if (key.match(/_creative$/) && value) {\n                    var zoneName = key.replace(/_creative$/, \"\");\n                    campaignStepMappings[zoneName] = campaignStepMappings[zoneName] || [];\n                    campaignStepMappings[zoneName].push({\n                        creativeUri: value,\n                        zoneName: zoneName,\n                        campaignId: campaignId\n                    });\n                }\n            });\n        });\n        return campaignStepMappings;\n    });\n\n    extole.define('zone-targeter', [\n        'campaign-step-mappings',\n        'http://origin.extole.io/type=core:clientId=1933045607:coreAssetsVersion=1499462991669/common/uri.js',\n        'http://origin.extole.io/type=core:clientId=1933045607:coreAssetsVersion=1499462991669/common/collection.js'\n    ], function (campaignStepMappings, uri, collection) {\n\n        var zoneNameToCampaignStepMappings = campaignStepMappings\n        var queryParameters = uri.deserialize(window.location.search);\n        var extoleCampaignIdQueryParameter = queryParameters.extole_campaign_id;\n\n        function getCreative(zoneName, zoneParameters, callback) {\n\n            var campaignStepMappings = zoneNameToCampaignStepMappings[zoneName];\n\n            if (!campaignStepMappings || !campaignStepMappings.length) {\n                callback(new Error(\"no creative is mapped to zone: \" + zoneName));\n                return;\n            }\n\n            var campaignStepMapping;\n            if (zoneParameters.campaign_id) {\n                campaignStepMapping =\n                    getCampaignStepMappingByCampaignId(campaignStepMappings, zoneParameters.campaign_id);\n            }\n            if (!campaignStepMapping && zoneParameters.extole_campaign_id) {\n                campaignStepMapping =\n                    getCampaignStepMappingByCampaignId(campaignStepMappings, zoneParameters.extole_campaign_id);\n            }\n            if (!campaignStepMapping && extoleCampaignIdQueryParameter) {\n                campaignStepMapping =\n                    getCampaignStepMappingByCampaignId(campaignStepMappings, extoleCampaignIdQueryParameter);\n            }\n            if (!campaignStepMapping) {\n                campaignStepMapping = getFirstMapping(campaignStepMappings);\n            }\n\n            extole.require([campaignStepMapping.creativeUri], function (render) {\n                callback(null, new Creative(render, campaignStepMapping.campaignId));\n            });\n\n        }\n\n        function getCampaignStepMappingByCampaignId(campaignStepMappings, campaignId) {\n            for (var i = 0; i < campaignStepMappings.length; i++) {\n                if (campaignStepMappings[i].campaignId === campaignId) {\n                    return campaignStepMappings[i];\n                }\n            }\n        }\n\n        function getFirstMapping(campaignStepMappings) {\n            return campaignStepMappings[0];\n        }\n\n        function Creative(render, campaignId) {\n\n            this.render = render;\n\n            this.getCampaignId = function () {\n                return campaignId;\n            };\n\n        }\n\n        return {\n            getCreative: getCreative\n        };\n\n    });\n\n    extole.define('request-zone-v5', [\n        'http://origin.extole.io/type=core:clientId=1933045607:coreAssetsVersion=1499462991669/common/ajax.js',\n        'sites',\n        'http://origin.extole.io/type=core:clientId=1933045607:coreAssetsVersion=1499462991669/common/collection.js',\n        'http://origin.extole.io/type=core:clientId=1933045607:coreAssetsVersion=1499462991669/common/type.js'\n    ], function (ajax, sites, collection, type) {\n\n        function requestZone(zoneName, zoneData, campaignId, callback) {\n\n            callback = callback || function () {};\n\n            extole.require(['http://origin.extole.io/type=core:clientId=1933045607:coreAssetsVersion=1499462991669/common/user-service.js'], function (userService) {\n\n                userService.getUser(function (error, user) {\n\n                    if (error) {\n                        callback(error);\n                        return;\n                    }\n\n                    var zoneRequestQueryParameters = flattenKeys(zoneData);\n                    zoneRequestQueryParameters['access_token'] = user.getAccessToken();\n                    if (campaignId) {\n                        zoneRequestQueryParameters['campaign_id'] = campaignId;\n                    }\n\n                    var site = sites.getDefault();\n                    var zoneRequestUrl = \"https://\" + site.program_domain + \"/zone/\" + zoneName;\n\n                    ajax({\n                        type: \"GET\",\n                        url: zoneRequestUrl,\n                        headers: {\n                            \"Accept\": \"text/javascript\"\n                        },\n                        xhrFields: {\n                            withCredentials: true\n                        },\n                        data: zoneRequestQueryParameters,\n                        complete: function () {\n                            callback(null);\n                        },\n                        error: function (xmlHttp, statusText, status) {\n                            callback(new Error(\"zone request for zone: \" + zoneName));\n                        }\n                    });\n\n                });\n            });\n\n        }\n\n        function flattenKeys(data) {\n\n            var flattenedParameters = {};\n\n            traverse(data, []);\n\n            return flattenedParameters;\n\n            function traverse(map, parentKeys) {\n\n                if (isLeaf(map)) {\n                    var flattenedKey = parentKeys.join('.');\n                    flattenedParameters[flattenedKey] = map;\n                    return;\n                }\n\n                collection.each(map, function (value, key) {\n\n                    var parentKeysCopy = parentKeys.slice();\n                    parentKeysCopy.push(key);\n\n                    traverse(value, parentKeysCopy);\n\n                });\n\n                function isLeaf(thing) {\n                    return !type.isPlainObject(thing);\n                }\n\n            }\n\n        }\n\n        return requestZone;\n\n    });\n\n    extole.define('find-element-by-id', [], function () {\n\n        function findElementById(elementId, callback) {\n\n            var discoveredElement;\n\n            repeatUntil(defineElement, isElementFound, done);\n\n            function defineElement() {\n                discoveredElement = document.getElementById(elementId);\n            }\n\n            function isElementFound()  {\n                return Boolean(discoveredElement);\n            }\n\n            function done() {\n                callback(discoveredElement);\n            }\n\n        }\n\n        function repeatUntil(method, test, done) {\n\n            var START_INTERVAL = 10;\n            var MAX_INTERVAL = 500;\n            var INTERVAL_INCREASE_RATE = 1.1;\n            var currentInterval;\n\n            poll();\n\n            function poll() {\n                if (test()) {\n                    done();\n                    return;\n                }\n\n                method();\n                setTimeout(poll, getNextInterval());\n            }\n\n            function getNextInterval() {\n                if (!currentInterval) {\n                    currentInterval = START_INTERVAL;\n                }\n                if (currentInterval > MAX_INTERVAL) {\n                    return MAX_INTERVAL;\n                }\n                currentInterval *= INTERVAL_INCREASE_RATE;\n                return currentInterval;\n            }\n        }\n\n        return findElementById;\n\n    });\n\n})();",
published_date:"2017711644"};extole.define("configuration","utils configuration/get-client-config configuration/api configuration/processors configuration/utils configuration/zones".split(" "),function(c,g,f,k,b,e){var a=this.async();g(function(d,h){if(d)throw Error("Error getting client config - "+d.message);var n=extole.SYSTEM_DOWN;f.set("CLIENT_CONFIG",k.clientConfig(h));f.set("SYSTEM_DOWN",n);f.set("CLIENT_DOWN",!!h.client.disabled);f.set("SITE_DOMAIN",extole.SITE_DOMAIN||location.hostname);c.extend(f,
{processors:k,utils:b,zones:e});a(f)})});extole.define("configuration/api",[],function(){var c={};return{set:function(g,f){c[g]=f},get:function(g){return c[g]}}});extole.define("configuration/get-client-config",["JSON","ajax"],function(c,g){var f=function(b){setTimeout(function(){var c=extole.CLIENT_ID;c?b(null,c):b(Error("Could not find client id"))},1)},k=function(b){f(function(e,a){e&&b?b(Error("Error fetching client id - "+e.message)):g({url:extole.MEDIA_SERVER+"/config/clients/"+a+"/client.json",
complete:function(a){b&&b(null,c.parse(a))},error:function(a){b&&b(Error("Problem fetching client config - "+a.message))}})})};return function(b){if(extole.CLIENT_CONFIG){var c=extole.CLIENT_CONFIG;setTimeout(function(){b&&b(null,c)},1)}else k(b)}});extole.define("configuration/processors",["utils"],function(c){var g={},f=function(c,b){for(var e in c)if(c.hasOwnProperty(e)){var a=b(e);e!==a&&(c[a]=c[e],delete c[e])}};g.clientConfig=function(g){if(g._processed)return g;var b=function(b){return b.toLowerCase()};
f(g.zones,b);c.each(g.zones,function(b,a){b.name=a});f(g.zone_defaults,b);f(g.cta_creative_name_to_id,b);f(g.campaign_name_to_id,b);g.campaign_id_to_name={};c.each(g.campaign_name_to_id,function(b,a){g.campaign_id_to_name[b]=a});g.cta_creative_id_to_name={};c.each(g.cta_creative_id_to_name,function(b,a){g.cta_creative_id_to_name[b]=a});g._processed=!0;return g};return g});extole.define("configuration/utils",["configuration/api","utils","cookie","JSON"],function(c,g,f,k){return{getSharedVars:function(){for(var b=
document.getElementsByTagName("script"),c={},a,d=0;d<b.length;d++)if("extole/context"==b[d].type){a=void 0;try{a=k.parse(b[d].innerHTML)}catch(h){g.log.error("Bad JSON in context script tag.")}a&&g.extend(c,a)}return c}}});extole.define("configuration/zones",["utils","configuration/api"],function(c,g){return{blacklisted:function(f){f=g.get("CLIENT_CONFIG").zones[f]||{};var k=!0,b=!1;f.whitelist&&(k=!!location.toString().match(new RegExp(f.whitelist)));f.blacklist&&(b=!!location.toString().match(new RegExp(f.blacklist)));
return b?(c.log("Location is on black list"),!0):k?!1:(c.log("Not on white list uri"),!0)}}});extole.define("cookie",["utils","JSON"],function(c,g){function f(a){return a}function k(a){try{return decodeURIComponent(a.replace(e," "))}catch(h){return c.log("** utils.cookie.decoded ** Cookie error",h.message,h),""}}function b(d){0===d.indexOf('"')&&(d=d.slice(1,-1).replace(/\\"/g,'"').replace(/\\\\/g,"\\"));try{return a.json?g.parse(d):d}catch(h){}}var e=/\+/g,a=function(d,h,e){if(void 0!==h){e=c.extend({},
a.defaults,e);if("number"===typeof e.expires){var l=e.expires,q=e.expires=new Date;q.setDate(q.getDate()+l)}h=a.json?g.stringify(h):String(h);return document.cookie=[a.raw?d:encodeURIComponent(d),"=",a.raw?h:encodeURIComponent(h),e.expires?"; expires="+e.expires.toUTCString():"",e.path?"; path="+e.path:"",e.domain?"; domain="+e.domain:"",e.secure?"; secure":""].join("")}h=a.raw?f:k;e=document.cookie.split("; ");for(var l=d?void 0:{},q=0,x=e.length;q<x;q++){var p=e[q].split("="),r=h(p.shift()),p=h(p.join("="));
if(d&&d===r){l=b(p);break}d||(l[r]=b(p))}return l};a.defaults={};return a});extole.define("create-zone",["zones","campaigns"],function(c,g){function f(b,c){if(!b)throw new k(c||"Assertion failed","assertion_failed");}function k(b,c){var a=Error.call(this,b);this.name="ExtoleError";this.message=a.message;this.stack=a.stack;this.code=c}k.prototype=Error();k.prototype.constructor=k;return function(b,e){e=e||function(){};f(b,"createZone requires a map of parameters");f(b.name,'createZone expects the "name" parameter to be present');
f(b.element,'createZone expects the "element" parameter to be present');var a=c.zone({name:b.name,type:b.name,element:b.element,data:{insert_position:"inside",parameters:b.parameters||{}}});a.data.parameters.campaign_id&&(a.data.campaign=a.data.parameters.campaign_id);g.renderZone(a,e)}});extole.define("creative-javascript-api/render/JsCampaign",[],function(){return function(c){this.getId=function(){return c.id}}});extole.define("creative-javascript-api/render/JsCreativeContext",["creative-javascript-api/render/JsZone",
"creative-javascript-api/render/JsCampaign","creative-javascript-api/render/JsProgram","utils"],function(c,g,f,k){return function(b){this.getCampaign=function(){return new g({id:b.campaign.id})};this.getZone=function(){return new c({element:b.element,name:b.getName(),parameters:b.getParameters()})};this.getProgram=function(){return new f}}});extole.define("creative-javascript-api/render/JsProgram",[],function(){return function(){var c=extole.site;this.getName=function(){return c.name};this.getProgramDomain=
function(){return c.program_domain};this.getSitePatterns=function(){return c.allowed_domains}}});extole.define("creative-javascript-api/render/JsZone",[],function(){return function(c){this.getElement=function(){return c.element};this.getName=function(){return c.name};this.getParameters=function(){return c.parameters||{}};this.getData=function(){return c.parameters||{}}}});extole.define("creatives",["utils","configuration"],function(c,g){var f=function(c,b){var e=g.get("CLIENT_CONFIG"),a;a=c.match(/^(https?|file):\/\//)?
!0:c.match(/^\/\//)?!0:!1;return a?c:"extole-media:/config/clients/"+e.client.client_id+"/creative_"+c+"."+g.get("PUBLISHED_DATE")+".js"};return{get:function(c,b){var e=f(c);extole.require([e],function(a){var d={},h="[object Object]"===Object.prototype.toString.call(a),c="function"===typeof a.render;h&&c?(d.render=a.render,d.isLegacyCreative=!0):d.render=a;b(null,d)})}}});extole.define("dom","utils dom/api dom/events dom/window dom/attributes dom/query dom/ready".split(" "),function(c,g,f,k,b,e,a){return c.extend(g,
{events:f,window:k,attributes:b,query:e,ready:a})});extole.define("dom/api",["utils","dom/events"],function(c,g){var f={x:0,y:0};g.add(document,"mousemove",function(b){f.x=b.pageX;f.y=b.pageY});var k=function(b){var a=document.createDocumentFragment(),d=document.createElement("div");d.innerHTML=b;c.each(d.childNodes,function(d){1==d.nodeType&&a.appendChild(d)});return a},b=function(b){var a;c.each(b.childNodes,function(d){a||1!=d.nodeType||(a=d)});return a};return{prepend:function(c,a){var d=b(c),
h=a;"string"==typeof a&&(h=k(a));d?c.insertBefore(h,d):c.appendChild(ode)},append:function(b,a){var d=a;"string"==typeof a&&(d=k(a));b.appendChild(d)},mouse:f}});extole.define("dom/attributes",["utils"],function(c){var g=function(f){f=f.className;var b={};if(!f)return b;c.each(f.split(" "),function(c){b[c]=1});return b},f=function(f){var b="";c.each(f,function(c,a){b+=" "+a});return b.slice(1)};return{set:function(c,b,e){c.setAttribute(b,e);c[b]=e},get:function(c,b){return c.getAttribute(b)},addClass:function(c,
b){var e=g(c);e[b]||(e[b]=1,c.className=f(e))},removeClass:function(c,b){var e=g(c);delete e[b];c.className=f(e)},getClassNames:g}});extole.define("dom/events",["utils"],function(c){var g=[],f=function(b,c,a){for(var d=[],h=0;h<g.length;h++){var n=g[h];n.element==b&&n.eventType==c&&n.listener==a&&d.push({index:h,eventListener:n})}return d},k=function(b){this.originalEvent=b;this.type=b.type;this.keyCode=b.keyCode;this.target=b.srcElement?b.srcElement:b.target};k.prototype={preventDefault:function(){var b=
this.originalEvent;b.preventDefault?b.preventDefault():b.returnValue=!1},stopPropagation:function(){var b=this.originalEvent;b.stopPropagation&&b.stopPropagation();b.cancelBubble=!0}};return{add:function(b,e,a){if(0<f(b,e,a).length)c.log("events.add - Listener already exists for event "+e+" on element "+b);else{var d=!b.addEventListener,h=function(h){d&&(h=window.event);return a.call(b,new k(h))};g.push({element:b,eventType:e,listener:a,listenerWrapper:h});b.addEventListener?b.addEventListener(e,
h,!1):b.attachEvent("on"+e,h)}},trigger:function(b,e,a){var d=document.createEvent("Event");d.initEvent(e,!0,!1);c.extend(d,a);b.dispatchEvent(d)},remove:function(b,e,a){a=f(b,e,a);0>=a.length?c.log("events.remove - Couldn't find exiting event listener for type \""+e+'" listener on element '+b):c.each(a,function(a){var h=a.index;a=a.eventListener;b.removeEventListener?b.removeEventListener(e,a.listenerWrapper,!1):b.detachEvent("on"+e,a.listenerWrapper);g.splice(h,1)})}}});extole.define("dom/query",
[],function(){return function(c,g){return(g||document).querySelectorAll(c)}});extole.define("dom/ready",["utils"],function(c){var g=c.generalReady();(function(){var c;document.addEventListener?c=function(){document.removeEventListener("DOMContentLoaded",c,!1);g.set()}:document.attachEvent&&(c=function(){"complete"===document.readyState&&(document.detachEvent("onreadystatechange",c),g.set())});"complete"===document.readyState&&g.set();document.addEventListener?(document.addEventListener("DOMContentLoaded",
c,!1),window.addEventListener("load",g.set,!1)):document.attachEvent&&(document.attachEvent("onreadystatechange",c),window.attachEvent("onload",g.set))})();return g});extole.define("dom/window",[],function(){return{getSize:function(){var c=document.documentElement,g=document.getElementsByTagName("body")[0];return{width:window.innerWidth||c.clientWidth||g.clientWidth,height:window.innerHeight||c.clientHeight||g.clientHeight}}}});extole.define("entity-events",["utils"],function(c){function g(a,d,b,
e){e=e.split(/\s+/);c.each(e,function(e){var n=a[e];n||c.throwError("bindEntityEvents","Method '"+e+"' was configured as an event handler, but does not exist.");a.listenTo(d,b,n)})}function f(a,d,b,c){a.listenTo(d,b,c)}function k(a,d,b,e){e=e.split(/\s+/);c.each(e,function(c){a.stopListening(d,b,a[c])})}function b(a,d,b,c){a.stopListening(d,b,c)}function e(a,d,b,e,l){d&&b&&(c.isFunction(b)&&(b=b.call(a)),c.each(b,function(b,h){c.isFunction(b)?e(a,d,h,b):l(a,d,h,b)}))}return{bind:function(a,d,b){e(a,
d,b,f,g)},unbind:function(a,d,c){e(a,d,c,b,k)}}});extole.define("events",["utils","configuration"],function(c,g){var f={},k=function(b,e){"object"==typeof b?c.each(b,function(a,d){k(d,a)}):c.each(b.split(" "),function(a){f[a]||(f[a]={name:a,callbacks:[]});f[a].callbacks.push(e)})};return{on:k,off:function(b,e){c.each(b.split(" "),function(a){if(f[a])if(e){var d=-1;c.each(f[a].callbacks,function(a,b){if(a==e)return d=b,!1});0<d&&f[a].callbacks.splice(d,1)}else f[a].callbacks=[]})},trigger:function(b,
e){var a=g.get("CLIENT_CONFIG");e=e||{};var d=e.sharedVars||g.utils.getSharedVars(),h={};c.each(e,function(a,d){"sharedVars"!==d&&"zoneName"!==d&&"campaignId"!==d&&(h[d]=a)});for(var a=a.client,n=c.extend(!0,h,d,{eventName:b,zoneName:e.zoneName,campaignId:e.campaignId,siteId:extole.site.id,clientId:a.client_id,clientName:a.name}),d=b.split(":"),a=d.length;0<a;a--){var l=d.slice(0,a).join(":");if(f[l]){c.each(f[l].callbacks,function(a){a(c.extend({},n,{eventNameRemainder:l}))});break}}}}});extole.define("JSON",
[],function(){var c;"object"!==typeof c&&(c={});(function(){function g(a){return 10>a?"0"+a:a}function f(a){e.lastIndex=0;return e.test(a)?'"'+a.replace(e,function(a){var d=h[a];return"string"===typeof d?d:"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+a+'"'}function k(b,c){var h,e,r,t,y=a,z,v=c[b];v&&v instanceof Date&&(h=v,v=isFinite(h.valueOf())?h.getUTCFullYear()+"-"+g(h.getUTCMonth()+1)+"-"+g(h.getUTCDate())+"T"+g(h.getUTCHours())+":"+g(h.getUTCMinutes())+":"+g(h.getUTCSeconds())+
"Z":null);"function"===typeof n&&(v=n.call(c,b,v));switch(typeof v){case "string":return f(v);case "number":return isFinite(v)?String(v):"null";case "boolean":case "null":return String(v);case "object":if(!v)return"null";a+=d;z=[];if("[object Array]"===Object.prototype.toString.apply(v)){t=v.length;for(h=0;h<t;h+=1)z[h]=k(h,v)||"null";r=0===z.length?"[]":a?"[\n"+a+z.join(",\n"+a)+"\n"+y+"]":"["+z.join(",")+"]";a=y;return r}if(n&&"object"===typeof n)for(t=n.length,h=0;h<t;h+=1)"string"===typeof n[h]&&
(e=n[h],(r=k(e,v))&&z.push(f(e)+(a?": ":":")+r));else for(e in v)Object.prototype.hasOwnProperty.call(v,e)&&(r=k(e,v))&&z.push(f(e)+(a?": ":":")+r);r=0===z.length?"{}":a?"{\n"+a+z.join(",\n"+a)+"\n"+y+"}":"{"+z.join(",")+"}";a=y;return r}}var b,e,a,d,h,n;"function"!==typeof c.stringify&&(e=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,h={"\b":"\\b","\t":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},c.stringify=
function(b,h,c){var e;d=a="";if("number"===typeof c)for(e=0;e<c;e+=1)d+=" ";else"string"===typeof c&&(d=c);if((n=h)&&"function"!==typeof h&&("object"!==typeof h||"number"!==typeof h.length))throw Error("JSON.stringify");return k("",{"":b})});"function"!==typeof c.parse&&(b=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,c.parse=function(a,d){function h(a,b){var c,e,f=a[b];if(f&&"object"===typeof f)for(c in f)Object.prototype.hasOwnProperty.call(f,
c)&&(e=h(f,c),void 0!==e?f[c]=e:delete f[c]);return d.call(a,b,f)}var c;a=String(a);b.lastIndex=0;b.test(a)&&(a=a.replace(b,function(a){return"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4)}));if(/^[\],:{}\s]*$/.test(a.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]").replace(/(?:^|:|,)(?:\s*\[)+/g,"")))return c=eval("("+a+")"),"function"===typeof d?h({"":c},""):c;throw new SyntaxError("JSON.parse");})})();return c});
extole.define("page-scanner",["utils","dom"],function(c,g){function f(){function a(){h||(f=!1,h=!0,setTimeout(function(){for(var q={},k=e.splice(0,e.length);0<k.length;){var p=k.shift(),r=q[p.selector];if(!r)try{r=g.query(p.selector)}catch(t){c.log.error("query error -"+p.selector)}r&&0<r.length&&p.withElements(r);p.shouldDelete()||e.push(p)}h=!1;f?a():b||(q=Math.ceil(50*(.3*Math.pow(1.017,d/50)+.7)),setTimeout(a,q),d=q)},1))}var d=0,h=!1,e=[],f=!1;this.queue=function(d){e.push(d);f=!0;h||a()};this.scan=
a}function k(a){var d=0,b=function(){return!0},e=function(){},f=!1;this.withElements=function(a){c.each(a,function(a){b(a)&&e(a)});d++};this.setFilter=this.andIts=function(a){b=a;return this};this.setCompleted=this.thenCall=function(a){e=a;return this};this.setDeleteAfterCall=this.andRemove=function(){f=!0};this.shouldDelete=function(){return 0<d&&!0===f?!0:!1};this.selector=a}var b=!1;g.ready(function(){b=!0});var e=new f;return{whenYouFind:function(a){var d=new k(a);setTimeout(function(){e.queue(d)},
1);return d},findAllTheThings:function(){e.scan()},reset:function(){e=new f}}});extole.define("params",["utils","validators"],function(c,g){var f={e:"email",f:"first_name",l:"last_name"},k="email first_name last_name source partner_conversion_id partner_user_id".split(" ");return{rekey:function(b){var e={};c.each(b,function(a,d){f[d]&&(d=f[d]);var b=/^tag:/.test(d),g=-1<c.inArray(d,k)?!0:!1;b||g||(d="tag:"+d);e[d]=a});return e},split:function(b,e){e=c.extend({validateEmail:!0},e||{});var a={init:{},
client:{}};if(!b)return a;c.each(b,function(d,b){var f=a.init;-1<b.indexOf("tag:")?(b=b.substring(4),f=a.client):"email"==b&&e.validateEmail&&!g.isEmail(d)&&(c.log("Initialized with invalid email address ("+d+") - (configUtils.getInitParams)"),d=void 0);f[b]=d});return a},removeTags:function(b){var e={};c.each(b,function(a,d){d=d.replace(/^tag:/,"");e[d]=a});return e}}});extole.define("request-zone",["sites","ajax","utils","utils/collections","http://origin.extole.io/type=core:clientId=1933045607:coreAssetsVersion=1499462991669/common/logger.js"],
function(c,g,f,k,b){function e(a){var b=a.code||"",c=a.description||"";this.stack=Error(c).stack;this.getCode=function(){return b};this.getDescription=function(){return c}}function a(a){function b(a,d){if("[object Object]"!==Object.prototype.toString.call(a)){var e=d.join(".");c[e]=a}else k.each(a,function(a,c){var e=d.slice();e.push(c);b(a,e)})}var c={};b(a,[]);return c}e.prototype=Error();e.prototype.constructor=e;return function(d,h,n){n=n||function(){};extole.require(["http://origin.extole.io/type=core:clientId=1933045607:coreAssetsVersion=1499462991669/shared/js/user-service.js"],
function(l){l.getUser(function(q,k){if(q)n(q);else{var p=c.getDefault(),r=k.getAccessToken(),t="https://"+p.program_domain+"/zone/"+d,p=f.extend({},a(h),{access_token:r});g({type:"GET",url:t,dataType:"json",xhrFields:{withCredentials:!0},data:p,complete:function(a){var d;try{d=JSON.parse(a).access_token}catch(c){b.warn("Could not parse zone response as JSON for zone: "+t)}d||"function"!==typeof this.getResponseHeader||(d=this.getResponseHeader("X-Extole-Token"));d&&d!==k.getAccessToken()&&l.setAccessToken(d);
n(null)},error:function(a,b,c){f.log("zone request for zone: "+d+" failed");a=new e({description:"zone request failed: "+b,code:"zone_request_exception"});n(a)}})}})})}});extole.define("services","utils services/share services/convert services/zone-convert services/confirm services/send-dashboard services/preshare services/click services/impression services/rewards services/claim-reward".split(" "),function(c,g,f,k,b,e,a,d,h,n,l){return{click:d,impression:h,share:g,convert:f,zoneConvert:k,confirm:b,
sendDashboard:e,preshare:a,rewards:n,claimReward:l}});extole.define("services/claim-reward",["utils","services/request"],function(c,g){var f=g({method:"post",requiredParams:["rewardId","rewardOptionId"],getCommonData:function(){return{}},onBeforeSend:function(){this.validateRequiredParams();this.url="//"+this.getProgramDomain()+"/api/v2/rewards/"+this.rewardId+"/claim";this.xhrFields={withCredentials:!0};this.data={reward_option_id:this.rewardOptionId}}});return c.factory(f)});extole.define("services/click",
["utils","services/stream"],function(c,g){var f=g({eventType:"CTA_CLICK"});return c.factory(f)});extole.define("services/confirm",["utils","services/request"],function(c,g){var f=g({method:"post",eventType:void 0,requiredParams:["confirmationCode","actionId"],onBeforeSend:function(){this.validateRequiredParams();this.url="//"+this.getProgramDomain()+"/v2/confirm";this.data={confirmation_code:this.confirmationCode,action_id:this.actionId}}});return c.factory(f)});extole.define("services/convert",["utils",
"services/request","user","params"],function(c,g,f,k){g=g({method:"post",requiredParams:[],validate:function(){this.validateRequiredParams()},onBeforeSend:function(){this.validate();this.url="//"+this.getProgramDomain()+"/v2/convert";this.data={action_type:(this.type||"PURCHASE").toUpperCase(),site_id:null}}});return c.factory(g)});extole.define("services/impression",["utils","services/stream"],function(c,g){var f=g({eventType:"CTA_IMPRESSION"});return c.factory(f)});extole.define("services/preshare",
["utils","services/request"],function(c,g){var f=g({method:"get",eventType:void 0,requiredParams:["campaignId"],onBeforeSend:function(){this.validateRequiredParams();this.url="//"+this.getProgramDomain()+"/v2/preshare/"+this.campaignId;this.data={confirmation_code:this.confirmationCode,action_id:this.actionId};this.xhrFields={withCredentials:!0}}});return c.factory(f)});extole.define("services/request","utils JSON dom ajax sites xd-messager-iframe params".split(" "),function(c,g,f,k,b,e,a){g=c.extend({validateRequiredParams:function(){var a=
this,b=[],e=this.requiredParams||[];c.each(e,function(c){var e=a[c];e||"string"==typeof e||b.push(c)});b.length&&this.silentFail("Must pass "+e.join(", ")+". Of those, you're missing "+b.join(", "))},getProgramUrl:function(){c.log("DEPRECATED. Use getProgramDomain.");return this.getProgramDomain()},getProgramDomain:function(){return b.getDefault().program_domain},silentFail:function(a){this.error=a},getCommonData:function(d){d=d||{};var h={};if(this.params){var e=a.rekey(this.params);d=a.split(e,
d);c.extend(h,d.init,{client_params:d.client})}d=f.window.getSize();return c.extend(h,{mouse_xy:Math.round(f.mouse.x)+","+Math.round(f.mouse.y),window_wh:d.width+","+d.height,screen_wh:screen.width+","+screen.height,site_id:b.getDefault().id})},send:function(a){var b=function(){},e=function(){};c.isPlainObject(a)?(b=a.complete||b,e=a.error||e):c.isFunction(a)&&(b=a);var f=this;this.triggerMethod("before:send");this.data=c.extend(!0,{},this.getCommonData(a),this.data);if(this.error)c.log.error("Request Error - ",
this.error,this);else{this.headers=this.headers||{};void 0===this.headers["Content-Type"]&&(this.headers["Content-Type"]="application/json");a={url:this.url,type:this.method,complete:function(){f.triggerMethod.apply(f,["send"].concat(arguments));b.apply(this,arguments)},error:function(){f.triggerMethod.apply(f,["send:error"].concat(arguments));e.apply(this,arguments)},data:this.data,xhrFields:c.extend(this.xhrFields,{withCredentials:!0}),headers:this.headers};var g=String(navigator.userAgent),x=g.match("Windows NT 10"),
g=g.match("rv:11");"undefined"!==typeof window.XDomainRequest||x&&g?this.sendViaIframe(a):k(a)}},sendViaIframe:function(a){var b=c.uniqueId("forwardAjaxCalls"),f=e.create(b);f.ready(function(){var b=f.socket;b.sendMessage("ajax",a);var c=function(h){b.off("ajaxComplete",c);a.complete.apply(h,arguments)},h=function(c){b.off("ajaxError",h);a.error.apply(c,arguments)};b.on("ajaxComplete",c);b.on("ajaxError",h)})}},c.events);return c.factory(g)});extole.define("services/rewards",["utils","services/request"],
function(c,g){var f=g({onBeforeSend:function(){this.validateRequiredParams();this.url="//"+this.getProgramDomain()+"/api/v2/rewards/unclaimed";this.xhrFields={withCredentials:!0}}});return c.factory(f)});extole.define("services/send-dashboard",["utils","services/request"],function(c,g){var f=g({method:"get",eventType:void 0,onBeforeSend:function(){this.url="//"+this.getProgramDomain()+"/v2/advdash/email/"}});return c.factory(f)});extole.define("services/share",["utils","services/request","user"],
function(c,g,f){g=g({method:"post",eventType:void 0,requiredParams:["channel","campaignId","siteId","zoneName"],validate:function(){this.validateRequiredParams();f.setFromShare(this);f.get("email")||this.silentFail("User must have email");"purl"==this.channel.toLowerCase()&&(this.actionId||this.silentFail("Purl share requires action id."),this.actionIdHash||this.silentFail("Purl share requires action id hash."))},onBeforeSend:function(){this.validate();this.url="//"+this.getProgramDomain()+"/v2/share";
this.data={channel:this.channel,campaign_id:this.campaignId,zone_name:this.zoneName,client_params:{cta_id:this.ctaCreativeId,zone_id:this.zoneId},email:f.get("email"),first_name:f.get("first_name"),last_name:f.get("last_name"),channel_email:this.email,channel_first_name:this.firstName,channel_last_name:this.lastName,channel_message:this.message,channel_access_token:this.accessToken,channel_access_token_secret:this.secret,source_url:window.location.toString(),resources:this.resources,recipients:this.recipients,
site_id:this.siteId};"purl"==this.channel.toLowerCase()&&(this.data.action_id=this.actionId,this.data.id_hash=this.actionIdHash)}});return c.factory(g)});extole.define("services/stream",["utils","services/request"],function(c,g){var f=g({method:"post",eventType:void 0,requiredParams:["campaignId","eventType"],onBeforeSend:function(){this.validateRequiredParams();this.url="//"+this.getProgramDomain()+"/v2/stream";this.data={campaign_id:this.campaignId,zone_name:this.zoneName,client_params:{cta_id:this.ctaCreativeId,
zone_id:this.zoneId},event_type:this.eventType}}});return c.factory(f)});extole.define("services/zone-convert",["request-zone","params"],function(c,g){function f(c){var b=c.code||"",e=c.description||"";this.stack=Error(e).stack;this.getCode=function(){return b};this.getDescription=function(){return e}}f.prototype=Error();f.prototype.constructor=f;return function(k,b){b=b||function(){};var e=function(a){var d;a=a.toLowerCase();if("purchase"===a)d="conversion";else if("register"===a||"registration"===
a)d="registration";return d||null}(k.type),a=function(a){a=g.rekey(a);return g.removeTags(a)}(k.parameters);if(!e){var d="Error: could not find zone based on type:"+k.type;extole.require(["http://origin.extole.io/type=core:clientId=1933045607:coreAssetsVersion=1499462991669/common/logger.js"],function(a){a.error(d)});e=new f({description:d,code:"error-no-type"});return b(e)}c(e,a,b)}});extole.define("sites",["utils","configuration","JSON"],function(c,g,f){function k(a){this.config=a;c.extend(this,
this.config)}k.prototype={isAllowedForDomain:function(a){if(this.config.program_domain==a)return!0;var d=this.config.allowed_domains||[];d.push("*.extole.com");var b=!1;c.each(d,function(d){(new RegExp(d.replace(/\./g,"\\.").replace(/\*/g,".*"))).test(a)&&(b=!0)});return b},getProgramDomain:function(){return this.config.program_domain}};var b=function(){var a=[],d=g.get("CLIENT_CONFIG").client;c.each(d.sites,function(d){a.push(new k(d))});return a},e=function(a){return c.map(b(),function(d){if(d.isAllowedForDomain(a))return d})};
return{getDefault:function(){var a=g.get("SITE_DOMAIN"),d=e(a)[0];d||c.log("No default site found for domain "+a);return d},filterByDomain:e}});extole.define("template",["utils"],function(c){var g=c.keys,f=c.invert,k=c.each,b=c.defaults,e={escape:{"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;"}};e.unescape=f(e.escape);var a={escape:new RegExp("["+g(e.escape).join("")+"]","g"),unescape:new RegExp("("+g(e.unescape).join("|")+")","g")},d,h;(function(){var b=function(d){return function(b){return null==
b?"":(""+b).replace(a[d],function(a){return e[d][a]})}};d=b("escape");h=b("unescape")})();var n={evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g,escape:/<%-([\s\S]+?)%>/g},l=/(.)^/,q={"'":"'","\\":"\\","\r":"r","\n":"n","\t":"t","\u2028":"u2028","\u2029":"u2029"},x=/\\|'|\r|\n|\t|\u2028|\u2029/g;return function(a,c,e){var f={escape:d,unescape:h,each:k},g;e=b({},e,n);var v=new RegExp([(e.escape||l).source,(e.interpolate||l).source,(e.evaluate||l).source].join("|")+"|$","g"),m=0,w="__p+='";
a.replace(v,function(d,b,c,h,e){w+=a.slice(m,e).replace(x,function(a){return"\\"+q[a]});b&&(w+="'+\n((__t=("+b+"))==null?'':_.escape(__t))+\n'");c&&(w+="'+\n((__t=("+c+"))==null?'':__t)+\n'");h&&(w+="';\n"+h+"\n__p+='");m=e+d.length;return d});w+="';\n";e.variable||(w="with(obj||{}){\n"+w+"}\n");w="var __t,__p='',__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,'');};\n"+w+"return __p;\n";try{g=new Function(e.variable||"obj","_",w)}catch(u){throw u.source=w,u;}if(c)return g(c,f);
c=function(a){return g.call(this,a,f)};c.source="function("+(e.variable||"obj")+"){\n"+w+"}";return c}});extole.define("user",["utils","params","cookie","configuration","dom"],function(c,g,f,k,b){var e=!1,a=c.extend({attributes:{},has:function(a){return void 0!==this.get(a)},get:function(a){return this.attributes[a]||this.cookieAttributes[a]},set:function(a,b){if(!c.inArray(a,["first_name","last_name","email"])||!this.attributes[a]){var e=this.attributes[a];if(b&&e!==b){this.attributes[a]=b;var g=
this,k={};c.each(["first_name","last_name","email"],function(a){k[a]=g.get(a)});f("extole_fle",JSON.stringify(k),{path:"/"});this.trigger("change")}}},toJson:function(){return c.extend({isAutoReg:this.isAutoReg()},this.cookieAttributes,this.attributes)},isAutoReg:function(){return!0===e},setFromShare:function(a){var b=this;c.each({first_name:"firstName",last_name:"lastName",email:"email"},function(c,e){b.set(e,a[c])})},setFromContext:function(a){if(a&&a.params){var b=this,f=this.attributes.email;
a=g.rekey(a.params);a=g.split(a).init;c.each(a,function(a,d){b.set(d,a)});f!==this.attributes.email&&(e=!0)}},logout:function(){f("extole_fle",null,{path:"/"});this.attributes=this.cookieAttributes={};this.trigger("logout")},cookieAttributes:function(){var a;try{a=JSON.parse(f("extole_fle"))||{}}catch(b){return{}}var e={};c.each(["first_name","last_name","email"],function(b){e[b]=a[b]});return e}()},c.events);b.ready(function(){a.setFromContext(k.utils.getSharedVars())});return a});extole.define("utils",
"utils/api utils/factory utils/string utils/events utils/location utils/insert-script".split(" "),function(c,g,f,k,b,e){return c.extend(c,{factory:g,string:f,events:k,location:b,insertScript:e})});extole.define("utils/api",["utils/collections","JSON"],function(c,g){var f=c.each,k=c.map,b=c.mapObj,e=c.has,a=c.keys,d=c.values,h=c.invert,n=c.toArray,l=c.inArray,q=c.isArray,x=c.isPlainObject,p=0,r=function(a){return a&&"function"===typeof a&&a.call&&a.apply};"undefined"!=typeof window.console&&(extole.console=
extole.console||console);var t;t=function(){var a,b,d,c,e,h=arguments[0]||{},f=1,g=arguments.length,l=!1;"boolean"===typeof h&&(l=h,h=arguments[1]||{},f=2);for("object"===typeof h||r(h)||(h={});f<g;f++)if(a=arguments[f],null!==a)for(b in a)d=h[b],c=a[b],h!==c&&(l&&c&&(x(c)||(e=q(c)))?(e?(e=!1,d=d&&q(d)?d:[]):d=d&&x(d)?d:{},h[b]=t(l,d,c)):void 0!==c&&(h[b]=c));return h};var m=Array.prototype.slice,z=function(a){if(!extole.suppressLog){var b=m.call(arguments,1);if(extole.console)try{extole.console[a].apply(extole.console,
b)}catch(d){for(var c=a.toUpperCase()+" - ",e=0;e<b.length;e++)c+=" "+b[e];extole.console.log(c)}}},v=function(){var a=m.call(arguments);z.apply(this,["log"].concat(a))},A=function(a){v[a]=function(){var b=m.call(arguments);z.apply(this,[a].concat(b))}};A("error");A("debug");A("info");A("warn");var w=extole.generalReady;extole.generalReady||(w=extole.generalReady=function(a){extole._generalReadyAnonKey||(extole._generalReadyAnonKey=0);var b=extole._generalReadyAnonKey++;a=t(a||{},{readyTest:void 0});
w.readies[b]||(w.readies[b]={ready:!1,funcs:[]});var d=function(a){a||w.readies[b].ready?w.readies[b].funcs.push(a):(w.readies[b].ready=!0,v.debug("** generalReady ** "+b+" - set ready"));if(w.readies[b].ready)for(;a=w.readies[b].funcs.pop();)setTimeout(a,0)};d.unset=function(){w.readies[b].ready=!1};d.set=function(){d()};d.isReady=function(){return w.readies[b].ready};return d},w.readies={});var u=function(a,b){b||(b=a,a="undefined");var d=Error("TYPE: "+a+"  MESSAGE: "+b);d.type=a;return d};return{uniqueId:function(a){var b=
++p+"";return a?a+b:b},each:f,map:k,mapObj:b,has:e,keys:a,values:d,invert:h,toArray:n,inArray:l,isEmpty:function(a){if(null===a)return!0;if(q(a)||"string"===typeof a)return 0===a.length;for(var b in a)if(e(a,b))return!1;return!0},isArray:q,isPlainObject:x,isFunction:r,proxy:function(a,b){var d;a.__proxiedContext===b?d=a:(d=function(){return a.apply(b,arguments)},d.__proxiedContext=b);return d},log:v,generalReady:w,extend:t,defaults:function(a){f(m.call(arguments,1),function(b){if(b)for(var d in b)void 0===
a[d]&&(a[d]=b[d])});return a},createObject:Object.create||function(a){var b=function(){};b.prototype=a;return new b},typedError:u,throwError:function(a,b){throw u(a,b);},handleError:function(a,b,d){d=d||function(){};try{b()}catch(c){if(c.type==a)return d(c),c;throw c;}}}});extole.define("utils/collections",[],function(){var c=Array.prototype.slice,g=function(a,b){return Object.prototype.hasOwnProperty.call(a,b)},f=function(a){if(!b(a))return[];var d=[],c;for(c in a)g(a,c)&&d.push(c);return d},k=function(a){for(var b=
f(a),d=b.length,c=Array(d),e=0;e<d;e++)c[e]=a[b[e]];return c},b=function(a){if("[object Object]"!==String(a)||a.nodeType||a.window&&a.window==a)return!1;try{if(a.constructor&&!a.constructor.prototype.hasOwnProperty("isPrototypeOf"))return!1}catch(b){return!1}return!0},e=function(a){return a instanceof Array},a=function(a,b){var d,c;if(a.length===+a.length)for(c=0;c<a.length;c++){if(d=b(a[c],c),!1===d)return!1}else for(c in a)if(a.hasOwnProperty(c)&&(d=b(a[c],c),!1===d))return!1};a.BREAK=!1;var d=
function(b,d){var c=[];a(b,function(a,b){var e=d(a,b);void 0!==e&&c.push(e)});return c};return{each:a,map:d,mapObj:function(b,d){var c={};a(b,function(a,b){var e=d(a,b);void 0!==e&&(e.key&&e.value?c[e.key]=e.value:c[b]=e)});return c},has:g,keys:f,values:k,invert:function(a){for(var b={},d=f(a),c=0,e=d.length;c<e;c++)b[a[d[c]]]=d[c];return b},toArray:function(a){return a?e(a)?c.call(a):a.length===+a.length?d(a,function(a){return a}):k(a):[]},inArray:function(a,b,d){var c;if(b)for(c=b.length,d=d?0>
d?Math.max(0,c+d):d:0;d<c;d++)if(d in b&&b[d]===a)return d;return-1},isArray:e,isPlainObject:b}});extole.define("utils/events",["utils/api"],function(c){var g=Array.prototype.slice,f={on:function(a,d,c){if(!b(this,"on",a,[d,c])||!d)return this;this._events||(this._events={});(this._events[a]||(this._events[a]=[])).push({callback:d,context:c,ctx:c||this});return this},listenTo:function(a,b,e){var f=this._listeningTo||(this._listeningTo={}),g=a._listenId||(a._listenId=c.uniqueId("l"));f[g]=a;e||"object"!==
typeof b||(e=this);a.on(b,e,this);return this},stopListening:function(a,b,e){var f=this._listeningTo;if(!f)return this;var g=!b&&!e;e||"object"!==typeof b||(e=this);a&&((f={})[a._listenId]=a);for(var k in f)a=f[k],a.off(b,e,this),(g||c.isEmpty(a._events))&&delete this._listeningTo[k];return this},off:function(a,d,e){var f,g,k,m,p,r,t,y;if(!this._events||!b(this,"off",a,[d,e]))return this;if(!a&&!d&&!e)return this._events=void 0,this;m=a?[a]:c.keys(this._events);p=0;for(r=m.length;p<r;p++)if(a=m[p],
k=this._events[a]){this._events[a]=f=[];if(d||e)for(t=0,y=k.length;t<y;t++)g=k[t],(d&&d!==g.callback&&d!==g.callback._callback||e&&e!==g.context)&&f.push(g);f.length||delete this._events[a]}return this},trigger:function(a){if(!this._events)return this;var d=g.call(arguments,1);if(!b(this,"trigger",a,d))return this;var c=this._events[a],f=this._events.all;c&&e(c,d);f&&e(f,arguments);return this}},k=/\s+/,b=function(a,b,c,e){if(!c)return!0;if("object"===typeof c){for(var f in c)a[b].apply(a,[f,c[f]].concat(e));
return!1}if(k.test(c)){c=c.split(k);f=0;for(var g=c.length;f<g;f++)a[b].apply(a,[c[f]].concat(e));return!1}return!0},e=function(a,b){var c,e=-1,f=a.length,g=b[0],k=b[1],p=b[2];switch(b.length){case 0:for(;++e<f;)(c=a[e]).callback.call(c.ctx);break;case 1:for(;++e<f;)(c=a[e]).callback.call(c.ctx,g);break;case 2:for(;++e<f;)(c=a[e]).callback.call(c.ctx,g,k);break;case 3:for(;++e<f;)(c=a[e]).callback.call(c.ctx,g,k,p);break;default:for(;++e<f;)(c=a[e]).callback.apply(c.ctx,b)}};f.triggerMethod=function(){function a(a,
b,c){return c.toUpperCase()}var b=/(^|:)(\w)/gi;return function(e){var f=this["on"+e.replace(b,a)];c.isFunction(this.trigger)&&this.trigger.apply(this,arguments);if(c.isFunction(f))return f.apply(this,c.toArray(arguments).slice(1))}}();return f});extole.define("utils/factory",["utils/api"],function(c){var g={};return c.extend(function(f,k){k=k||function(){};var b=function(e,a){var d="boolean"==typeof b.deepExtend?b.deepExtend:!1,h;h=e||{};a||(a=f);if(!0!==h.__created){h=c.createObject(a);g[h]={parent:a};
var n=[h,e];d&&n.splice(0,0,!0);c.extend.apply(null,n);k.call(h,h);h.__created=!0}return h};return b},{getInfo:function(c){return g[c]},getProto:function(c){return(c=g[c])&&c.parent}})});extole.define("utils/insert-script",[],function(){var c="PLAYSTATION 3"===navigator.platform?/^complete$/:/^(complete|loaded)$/,g=function(f,g){g=g||function(){};var b=function(e){var a=f.readyState;if("load"===e.type||a.match(c))f.detachEvent?f.detachEvent("onreadystatechange",b):f.removeEventListener("load",b),
g(e)};f.attachEvent?f.attachEvent("onreadystatechange",b):f.addEventListener("load",b,!1)};return function(c,k){var b=document.createElement("script");b.async=!0;g(b,function(){k(null)});b.src=c;document.getElementsByTagName("head")[0].appendChild(b)}});extole.define("utils/location",["utils/api"],function(c){return{serialize:function(g){var f="";c.each(g,function(c,b){void 0!==b&&void 0!==c&&(f+="&"+encodeURIComponent(b)+"="+encodeURIComponent(String(c)))});0<f.length&&(f="?"+f.slice(1));return f},
deserialize:function(g){if(!g)return{};var f={};g=g.substring(1).split("&");for(var k=0;k<g.length;k++){var b=g[k],e=b.substring(0,b.indexOf("=")),b=b.substring(b.indexOf("=")+1);if(e&&b)try{f[e]=decodeURIComponent(b)}catch(a){c.log("Bad Query Param "+e+" : "+b)}}return f}}});extole.define("utils/string",[],function(){var c=function(c){return c.replace(/(_.)/g,function(c,g){return g.replace("_","").toUpperCase()})};return{toCamelCase:c,toPascalCase:function(g){g=c(g);return g=g.substring(0,1).toUpperCase()+
g.substring(1)},trim:function(c){return c.replace(/^\s+/,"").replace(/\s+$/,"")}}});extole.define("validators",[],function(){return{isEmail:function(c){c=String(c);c=c.replace(/^\s+/,"").replace(/\s+$/,"");return c.match(/^((([a-z]|\d|[!#\$%&'\*\+\-\/=\?\^_`{\|}~]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+(\.([a-z]|\d|[!#\$%&'\*\+\-\/=\?\^_`{\|}~]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+)*)|((\x22)((((\x20|\x09)*(\x0d\x0a))?(\x20|\x09)+)?(([\x01-\x08\x0b\x0c\x0e-\x1f\x7f]|\x21|[\x23-\x5b]|[\x5d-\x7e]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(\\([\x01-\x09\x0b\x0c\x0d-\x7f]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]))))*(((\x20|\x09)*(\x0d\x0a))?(\x20|\x09)+)?(\x22)))@((([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.)+(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))$/i)}}});
extole.define("xd-messager-iframe",["utils","xd-messager","configuration","sites","dom"],function(c,g,f,k,b){return{create:function(e){e||(e=c.uniqueId("socket-iframe"));var a=c.generalReady(),d=k.getDefault().program_domain,h=f.get("CLIENT_CONFIG");extole.MEDIA_SERVER.match(/^\/\/([a-zA-Z\.-]+)/);var h=h.client.client_id,n=document.createElement("iframe");n.src=location.protocol+"//"+d+"/xd-arbiter-origin/"+h+"?coreRoot="+encodeURIComponent(location.protocol+extole.MEDIA_SERVER)+"&socketId="+e;c.each({scrolling:"no",
frameborder:"0",allowTransparency:"true",seamless:"seamless"},function(a,c){b.attributes.set(n,c,a)});document.body.appendChild(n);var l=g.create(e);b.events.add(n,"load",function(){l.sendTo=n.contentWindow;var b,c=function(){l.off("ready",c);clearInterval(b);a()};l.on("ready",c);b=setInterval(function(){l.sendMessage("ready?")},250)});return{socket:l,iframe:n,ready:a}}}});extole.define("xd-messager",["utils","JSON"],function(c,g){var f=function(b){window.addEventListener?window.addEventListener("message",
b,!1):window.attachEvent("onmessage",b)},k={listen:function(){var b=this;this._listener=function(c){c=c.data;var a=c.split("-"),d=a[0],f=a[1],a=a[2];if(d!=b.id)return!1;if(a)try{var k=c.substring(d.length+1+f.length+1),a=g.parse(k)}catch(l){}b.trigger(f,a)};f(this._listener)},stopListening:function(){if(this._listener){var b=this._listener;window.removeEventListener?window.removeEventListener("message",b):window.detachEvent("onmessage",b)}},destroy:function(){this.stopListening()},sendMessage:function(b,
c){var a;a=this.id+"-"+b;c&&(a+="-"+g.stringify(c));this.sendTo.postMessage(a,"*")}};return{create:function(b,e){e||(e={});b||(b=c.uniqueId("socket_"));var a=c.createObject(k);c.extend(a,{id:b,options:e,sendTo:e.sendTo||window.parent},c.events);a.listen();return a}}});extole.define("zones",["zones/zone","zones/default-content","zones/resources","zones/requester"],function(c,g,f,k){return{zone:c,defaultContent:g,resources:f,requester:k}});extole.define("zones/creative-placement",["utils","dom"],function(c,
g){var f=function(b,a){var c=b;"none"!==a&&(c=document.createElement("span"));return c},k=function(b,a,c,f){var n=arguments,l=a.parentNode;if(!l)return g.ready(function(){l||(document.body.appendChild(a),k.apply(null,n))}),!1;"replace"==c?(l.insertBefore(b,a),l.removeChild(a)):"before"==c?l.insertBefore(b,a):"after"==c?a.nextSibling?l.insertBefore(b,a.nextSibling):l.appendChild(b):"inside"==c&&a.appendChild(b);f(null)},b=function(b){b=c.extend({insertPosition:void 0,referenceElement:void 0},b||{});
var a=b.insertPosition;b=b.referenceElement;a||(a="before","*"==b?a="inside":b&&(a="none"));return a};return{renderElement:function(c,a){var d=c.getData(),d=b({insertPosition:d.insert_position,referenceElement:d.reference_element}),h=c.element,g=f(h,d);k(g,h,d,function(){a(null,g)});return g},getInsertPosition:b}});extole.define("zones/default-content",["configuration","utils"],function(c,g){var f={},k={none:function(){return document.createDocumentFragment()},size:function(b){var c=document.createDocumentFragment(),
a=document.createElement("span"),d=["height","width"],f,g=b.default_types.size;a.style.display="block";for(var k=0;k<d.length;k++)b=d[k],f=g[b]+"px",a.style[b]=f;c.appendChild(a);return c},html:function(b){var c=document.createDocumentFragment(),a=document.createElement("div");for(a.innerHTML=b.default_types.html;0<a.childNodes.length;)c.appendChild(a.childNodes[0]);return c}};return{shouldShow:function(b){var e=c.get("CLIENT_CONFIG");b=b.name.toLowerCase();e=e.zones[b];return!0===c.get("SYSTEM_DOWN")?
(f[b]="the system is off",!0):!0===c.get("CLIENT_DOWN")?(f[b]="the client is disabled",!0):e&&void 0!==e.disabled&&!0===e.disabled?(f[b]="the zone is disabled",!0):c.zones.blacklisted(b)?(f[b]="the zone is blacklisted",!0):!1},getElement:function(b){var e=c.get("CLIENT_CONFIG");b=b.name.toLowerCase();var e=e.zones[b],a=f[b];g.log("Showing default content for "+b+(a?" because "+a:""));if(!e)return g.log("There was no config for the given zone, so I couldn't show the default content."),document.createDocumentFragment();
b="none";e.default_type&&(b=e.default_type);e.default_types&&e.default_types[b]&&!e.reference_element||(b="none");return k[b](e)}}});extole.define("zones/requester","JSON utils dom configuration page-scanner zones/zone campaigns".split(" "),function(c,g,f,k,b,e,a){function d(a){function d(c,e){e=e||function(){};var f;f=c.reference_element&&"*"==c.reference_element?"body":c.reference_element?c.reference_element:!1;if(!f)return e(null,a);b.whenYouFind(f).thenCall(function(a){e(null,a)}).andRemove()}
this.prepare=function(b){b=b||function(){};var e;try{e=c.parse(a.innerHTML)}catch(f){return b(Error("element has bad JSON, can't make zone. html: "+a.innerHTML))}var m=(e.zone||"default").toLowerCase(),p=k.get("CLIENT_CONFIG").zones[m]||{},r=g.extend(!0,{},p,e);d(r,function(a,c){if(a)return b(a);b(null,m,{id:p.id,element:c,data:r})})}}return new function(){function c(){m||b.whenYouFind('script[type="extole/widget"]').thenCall(function(a){a.hasBeenUsed||(a.hasBeenUsed=!0,(new d(a)).prepare(function(a,
b,c){if(a)return g.log("couldn't prepare page request "+a.message);l(b,c)}))});m=!0;b.findAllTheThings()}function k(){if(!q){var a=g.location.deserialize(location.search),b=a.extole_zone_name||a.xtl_zone_name,c=a.extole_campaign_id||a.xtl_campaign_id;b?(q=!0,f.ready(function(){var a="extole-"+b+"-zone",d=document.getElementById(a);d||(d=document.createElement("div"),d.id=a,document.body.appendChild(d));l(b,{fromUri:!0,element:d,data:{campaign:c,insert_position:"none",parameters:{source:g.location.deserialize(location.search).extole_source}}})})):
g.log("uri zone has no zone name")}}function l(b,c){c=c||{};var d=e(g.extend({name:b,type:b},c));a.renderZone(d)}var q=!1,m=!1;this.start=function(){c();k()};this.request=l}});extole.define("zones/resources",["utils","extole-creatives:/shared/js/legacy-resource-selector.js"],function(c,g){var f=function(b){return(new Function("legacyResourceSelector",b))(g)},k=function(b,a){var c=f(b),g="";if(!c)return"";"::content::"==a?g=c.textContent||c.innerText||c.innerHTML:"string"==typeof a&&(g=c[a]?c[a]:c.getAttribute?
c.getAttribute(a):"");return g},b=function(b){var a="",d=c.location.deserialize(location.search);"element"==b.resource_type?a=k(b.selector,b.attr):"query_param"==b.resource_type&&(a=d[b.param_name]);return a};return{getElementFromSelector:f,getValueFromSelector:k,getValueFromRule:b,getValuesFromRules:function(c){c=c||[];var a={},d;for(d in c)c.hasOwnProperty(d)&&(a[d]=b(c[d]));return a},getQueryParameterByName:function(b){for(var a=location.search.substring(1).split("&"),c=0;c<a.length;c++){var f=
a[c].split("=");if(decodeURIComponent(f[0])==b)return decodeURIComponent(f[1])}return""}}});extole.define("zones/zone",["utils","configuration","zones/default-content","zones/creative-placement"],function(c,g,f,k){var b=[],e={elementReady:function(a){var b=this;k.renderElement(this,function(c,e){b.element=e;a&&a(c,e)})},shouldShowDefaultContent:function(){return f.shouldShow(this)},renderDefaultContent:function(){var a=f.getElement(this),b=this.element;b||c.throwError("zone","Tried to render default content without an element");
c.each(a.childNodes,function(a){a&&b.appendChild(a)})},getConfig:function(){var a=this.getName();return g.get("CLIENT_CONFIG").zones[a]},getInsertPosition:function(){return k.getInsertPosition({insertPosition:this.data.insert_position,referenceElement:this.data.reference_element})},getData:function(){return this.data},getType:function(){return this.type||"cta"},getName:function(){return this.name&&this.name.toLowerCase()},getParameters:function(){return c.extend({},this.data.parameters,this.data.params)},
removeCampaignReferences:function(){this.data.parameters&&delete this.data.parameters.campaign_id;this.data.params&&delete this.data.params.campaign_id;this.campaign&&delete this.campaign},destroy:function(){this.element&&this.element.parentNode&&this.element.parentNode.removeChild(this.element);for(var a=0;a<b.length&&b[a]!=this;a++);b.splice(a,1)}},a=function(a){var f;f=a||{};!0!==f.__created&&(f=c.createObject(e),c.extend(f,a),b.push(f),f.__created=!0);return f};c.extend(a,{getZones:function(){return b}});
return a})})();extole.define("http://origin.extole.io/type=core:clientId=1933045607:coreAssetsVersion=1499462991669/common/ajax.js",["ajax"],function(m){return m});
extole.define("http://origin.extole.io/type=core:clientId=1933045607:coreAssetsVersion=1499462991669/common/logger.js",[],function(){function m(a,d,h){h=h||{};h.pageId=g;h.referer=f;try{d=[a,d||"","START_JSON",JSON.stringify(h),"END_JSON"].join(" ")}catch(n){c("Failed to stringify log's json data",{exception:n});return}e[d]=++e[d]||1;k[a]>=k[extole.LOG_LEVEL_CONSOLE]&&window.console&&window.console.log&&window.console.log(d);k[a]>=k[extole.LOG_LEVEL_REMOTE]&&(a=e[d],b[a]&&u(d+(1<a?" log count: "+
a:"")))}function u(a){extole.require(["http://origin.extole.io/type=core:clientId=1933045607:coreAssetsVersion=1499462991669/common/api.js"],function(b){var c="/debug/logs",e;a:{e=document.cookie.split(";");for(var f=0;f<e.length;f++){var g=e[f].replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"");if(0===g.indexOf("extole_access_token=")){e=g.substring(20,g.length);break a}}e=null}e&&"null"!=e&&"undefined"!=e&&(c+="?access_token="+e);b.post(c,{message:a})})}function c(a,b){m("ERROR",a,b)}var g=String((new Date).getTime()),
f=window.location.href,k={DEBUG:0,INFO:1,WARN:2,ERROR:3,OFF:4},b={1:!0,3:!0,10:!0,30:!0,100:!0,250:!0,500:!0,1E3:!0},e={};extole.LOG_LEVEL_CONSOLE=extole.LOG_LEVEL_CONSOLE||"OFF";extole.LOG_LEVEL_REMOTE=extole.LOG_LEVEL_REMOTE||"WARN";return{debug:function(a,b){m("DEBUG",a,b)},info:function(a,b){m("INFO",a,b)},warn:function(a,b){m("WARN",a,b)},error:c,LOGGING_ENDPOINT:"/debug/logs"}});
extole.define("http://origin.extole.io/type=core:clientId=1933045607:coreAssetsVersion=1499462991669/common/collection.js",["utils","http://origin.extole.io/type=core:clientId=1933045607:coreAssetsVersion=1499462991669/common/type.js"],function(m,u){return{each:m.each,map:function(c,g){return m.isPlainObject(c)?m.mapObj(c,g):m.map(c,g)},filter:function(c,g){var f;if(u.isArray(c))f=[],m.each(c,function(c,b){g(c,b)&&f.push(c)});else if(u.isPlainObject(c))f={},m.each(c,function(c,b){g(c,b)&&(f[b]=c)});
else throw new ExtoleError(c+" argument must be type object or array","INVALID_ARGUMENT_EXCEPTION");return f},merge:m.extend}});
extole.define("http://origin.extole.io/type=core:clientId=1933045607:coreAssetsVersion=1499462991669/common/uri.js",["utils"],function(m){return{serialize:m.location.serialize,deserialize:m.location.deserialize,objectToDotNotation:function(m){function c(f,k){for(var b in f){var e=f[b],a=k?k+"."+b:b;e&&"object"===typeof e?c(e,a):g[a]=e}}var g={};c(m);return g},dotNotationToObject:function(m){var c={},g;for(g in m){for(var f=c,k=g.split("."),b=k.pop();k.length;)var e=k.shift(),f=f[e]=f[e]||{};f[b]=
m[g]}return c},decodeComponent:function(m){try{return decodeURIComponent(m)}catch(c){return m}},encodeComponent:function(m){return encodeURIComponent(m)}}});
extole.define("http://origin.extole.io/type=core:clientId=1933045607:coreAssetsVersion=1499462991669/common/dom.js",["dom"],function(m){var u={},c=function(c,b){function e(){b();f.removeEventListener(a,"load",e)}if(u[c])return b();u[c]=!0;var a=document.createElement("link");f.setAttribute(a,"rel","stylesheet");f.setAttribute(a,"href",c);f.append(f.query("head")[0],a);f.addEventListener(a,"load",e)},g=function(f,b){0===f.length?b():c(f[0],function(){g(f.slice(1),b)})},f={addEventListener:m.events.add,
removeEventListener:m.events.remove,triggerEvent:m.events.trigger,getAttribute:m.attributes.get,setAttribute:m.attributes.set,addClass:m.attributes.addClass,removeClass:m.attributes.removeClass,getClassNames:function(){return Object.keys(m.attributes.getClassNames.apply(null,arguments))},prepend:m.prepend,append:m.append,query:m.query,queryFirst:function(c,b){return m.query(c,b)[0]},injectStylesheet:c,injectStylesheets:g};return f});
extole.define("http://origin.extole.io/type=core:clientId=1933045607:coreAssetsVersion=1499462991669/common/event-bus.js",["utils"],function(m){var u=Array.prototype.slice;return{create:function(){var c=m.extend({},m.events);c.once=function(g,f,k){var b=function(){var e=u.call(arguments);f.apply(this,e);c.off(g,b,k)};c.on(g,b,k);return c};return c}}});extole.define("http://origin.extole.io/type=core:clientId=1933045607:coreAssetsVersion=1499462991669/common/JSON.js",["JSON"],function(m){return m});
extole.define("http://origin.extole.io/type=core:clientId=1933045607:coreAssetsVersion=1499462991669/common/type.js",[],function(){return{isPlainObject:function(m){return"[object Object]"===Object.prototype.toString.call(m)},isPlainFunction:function(m){return"[object Function]"===Object.prototype.toString.call(m)},isArray:function(m){return"[object Array]"===Object.prototype.toString.call(m)}}});
extole.define("http://origin.extole.io/type=core:clientId=1933045607:coreAssetsVersion=1499462991669/common/user-service.js","http://origin.extole.io/type=core:clientId=1933045607:coreAssetsVersion=1499462991669/common/collection.js http://origin.extole.io/type=core:clientId=1933045607:coreAssetsVersion=1499462991669/common/uri.js http://origin.extole.io/type=core:clientId=1933045607:coreAssetsVersion=1499462991669/common/logger.js http://origin.extole.io/type=core:clientId=1933045607:coreAssetsVersion=1499462991669/common/event-bus.js http://origin.extole.io/type=core:clientId=1933045607:coreAssetsVersion=1499462991669/common/cookie.js http://origin.extole.io/type=core:clientId=1933045607:coreAssetsVersion=1499462991669/common/api.js".split(" "),
function(m,u,c,g,f,k){function b(){function a(){function b(a){var c=location.pathname.split("/");c.shift();c.pop();c.length&&m.each(c,function(b,d){var e="/"+c.slice(0,d+1).join("/");f(a,"",{expires:-1,path:e})})}this.get=function(a){return f(a)};this.set=function(a,c){extole.COOKIES_DISABLED||(b(a),f(a,c,{expires:1825,path:"/"}))};this.remove=function(a){f(a,"",{expires:-1,path:"/"});b(a)}}function b(){(function(){var a="test"+(new Date).getTime();try{localStorage.setItem(a,a),localStorage.removeItem(a)}catch(b){throw Error("Local storage not supported");
}})();this.get=function(a){return window.localStorage.getItem(a)};this.set=function(a,b){window.localStorage.setItem(a,b)};this.remove=function(a){window.localStorage.removeItem(a)}}var e=[];e.push(new function(){var a={};this.get=function(b){return a[b]};this.set=function(b,c){a[b]=c};this.remove=function(b){delete a[b]}});extole.COOKIES_DISABLED||e.push(new a);if(extole.LOCAL_STORAGE_ENABLED)try{e.push(new b)}catch(g){c.info("Local Storage not supported in current browser")}this.get=function(){for(var a,
b=0;b<e.length;b++){a=e[b];var c=a.get("extole_access_token");if("string"===typeof c&&"undefined"!==c&&"null"!==c&&c.length)return a.get("extole_access_token")}};this.set=function(a){m.each(e,function(b){b.set("extole_access_token",a)})};this.remove=function(){m.each(e,function(a){a.remove("extole_access_token")})}}function e(a){function b(){return a.get()||""}function c(a){a.parameters=m.merge({},f.parameters,a.parameters);return m.merge({},f,a)}function e(){m.each(f,function(a,b){f[b]=void 0})}
var f={},g={getAccessToken:function(){return f.access_token},getId:function(){return f.id},getEmail:function(){return f.email},getFirstName:function(){return f.first_name},getLastName:function(){return f.last_name},getParameters:function(){return f.parameters},getMe:function(){return{id:f.id,email:f.email,first_name:f.first_name,last_name:f.last_name,profile_picture_url:f.profile_picture_url,partner_user_id:f.partner_user_id,parameters:f.parameters}},getCapabilities:function(){return Array.isArray(f.capabilities)?
f.capabilities.slice():[]},getScopes:function(){return Array.isArray(f.scopes)?f.scopes.slice():[]}};m.merge(this,g);(function(){var b=u.deserialize(window.location.search).extole_access_token;b&&a.set(b)})();this.asReadOnly=function(){return g};this.fetchAccessToken=function(e){var g=b(),l="/token";g&&(l+="?access_token="+g);k.get(l,function(b,g){b?e(b):(a.set(g.access_token),f=c(g),e())})};this.upgradeAccessToken=function(a,d){var e="/token/"+b()+"/upgrade";k.post(e,{extole_secret:a},function(a,
b){a?d(a):(f=c(b),d())})};this.deleteAccessToken=function(c){var f=b();e();a.remove();k.del("/token?access_token="+f,function(a,b){c(a,b)})};this.fetchAttributes=function(a){var d=b();k.get("/me?access_token="+d,function(b,d){b?a(b):(f=c(d),a(null,f))})};this.saveAttributes=function(a,d){var e=b(),g={email:a.email,first_name:a.first_name,last_name:a.last_name,profile_picture_url:a.profile_picture_url,partner_user_id:a.partner_user_id};k.post("/me?access_token="+e,g,function(a,b){a?d(a):(f=c(g),d(null,
f))})};this.fetchParameters=function(a){var d=b();k.get("/me/parameters?access_token="+d,function(b,d){b?a(b):(f=c({parameters:d}),a(null,f.parameters))})};this.saveParameters=function(a,d,e){d="PRIVATE"===(d||"PRIVATE").toUpperCase()?"PRIVATE":"PUBLIC";e=e||function(){};var g=b();k.post("/me/parameters?access_token="+g,{type:d,parameters:a},function(b,d){b?e(b):(f=c({parameters:a}),e(null,f.parameters))})};this.fetchAdvocates=function(a){var c=b();k.get("/me/advocates?access_token="+c,function(b,
c){a(b,c)})}}function a(){var a=0,b=[],c=this;this.push=function(a){b.push(a);this.next()};this.next=function(){for(;1>a&&b.length;)b.shift()(function(){a--;c.next()}),a++}}return new function(){function d(a){m.push(function(b){Boolean(p.getAccessToken())?a(null,b):f(function(c){a(c,b)})})}function f(a){function b(c){!c&&t&&(t=!1,r.events.trigger("login",p.asReadOnly()));a(c)}p.fetchAccessToken(function(c){c?"invalid_access_token"===c.code?k(b):a(c):l(b)})}function k(a){p.deleteAccessToken(function(b){p.fetchAccessToken(a)})}
function l(a){p.fetchAttributes(function(b){var c=y();b||!c?setTimeout(a,0):p.upgradeAccessToken(c,function(b){a(null)})})}var m=new a,x=new b,p=new e(x),r=this,t=!0;this.events=g.create();this.setAccessToken=function(a){x.set(a);this.flush()};this.getUser=function(a){a=a||function(){};d(function(b,c){b?a(b):a(null,p.asReadOnly());c()})};this.flush=function(a){a=a||function(){};m.push(function(b){f(function(c){c?a(c):a(null,p.asReadOnly());b()})})};this.updateMe=function(a,b){b=b||function(){};d(function(c,
d){function e(a,c){b(a,c);d()}c?e(c):a.email||a.first_name||a.last_name||a.profile_picture_url||a.partner_user_id?p.saveAttributes(a,function(a){a?e(a):e(null,p.asReadOnly())}):e(null,p.asReadOnly())})};this.updateProfile=function(a,b){c.warn("userService.updateProfile is deprecated");return this.updateMe(a,b)};this.updateParameters=function(a,b,c){"function"!==typeof b||c||(c=b,b=void 0);c=c||function(){};d(function(d,e){d?(c(d,void 0),e()):p.saveParameters(a,b,function(a){a?c(a,void 0):(a=p.asReadOnly(),
c(null,a));e()})})};this.fetchParameters=function(a){a=a||function(){};d(function(b,c){b?(a(b,void 0),c()):p.fetchParameters(function(b,d){b?a(b,void 0):a(null,d);c()})})};this.fetchAdvocates=function(a){a=a||function(){};d(function(b,c){b?(a(b,void 0),c()):p.fetchAdvocates(function(b,d){b?a(b,void 0):a(null,d);c()})})};this.logout=function(a){a=a||function(){};d(function(b,c){b?(a(b),c()):p.deleteAccessToken(function(b){t=!0;r.events.trigger("logout",p.asReadOnly());a(null);c();r.getUser(function(){})})})};
var y=function(){var a=u.deserialize(window.location.search).extole_secret;return function(){var b=a;b&&(a=null);return b}}()}});
extole.define("http://origin.extole.io/type=core:clientId=1933045607:coreAssetsVersion=1499462991669/common/api.js",["http://origin.extole.io/type=core:clientId=1933045607:coreAssetsVersion=1499462991669/common/collection.js","http://origin.extole.io/type=core:clientId=1933045607:coreAssetsVersion=1499462991669/common/logger.js","sites","http://origin.extole.io/type=core:clientId=1933045607:coreAssetsVersion=1499462991669/common/ajax.js","http://origin.extole.io/type=core:clientId=1933045607:coreAssetsVersion=1499462991669/common/JSON.js"],
function(m,u,c,g,f){function k(a){a=a.getDefault();if(!a||!a.program_domain)throw new b("No program domain is configured for hostname: "+location.hostname,"SITE_CONFIGURATION_ERROR");return a.program_domain}function b(a,b){var c=Error.call(this,a);this.name="ExtoleError";this.message=c.message;this.stack=c.stack;this.code=b}function e(){var a,b,c,e;this.withRequestSummary=function(a){c=a;return this};this.withResponseSummary=function(a){e=a;return this};this.asDebug=function(){b="Completed api request";
a="debug";return this};this.asError=function(){b="Failed api request";a="error";return this};this.log=function(){if(-1===c.url.indexOf(u.LOGGING_ENDPOINT))u[a](b,{request:c,response:e})}}b.prototype=Error();b.prototype.constructor=b;return new function(){function a(a,c,k,q){3===arguments.length&&(q=k,k={});var u="https://"+b+"/api/v4"+c;m.merge({},k);g({timeout:5E3,url:u,type:a,complete:function(a){var b=null;try{a=f.parse(a)}catch(c){a=null,b=Error("Couldn't parse as JSON response from request, response: "+
a)}q&&q(b,a);a=m.merge({},a);a.timestamp=String((new Date).getTime());(new e).withRequestSummary(p).withResponseSummary(a).asDebug().log()},error:function(a,b){var c;try{c=f.parse(this.response)}catch(d){c={statusText:this.statusText,status:b}}q&&q(c);c=m.merge({},c);c.timestamp=String((new Date).getTime());(new e).withRequestSummary(p).withResponseSummary(c).asError().log()},data:k,headers:{"Content-Type":"application/json"},xhrFields:{withCredentials:!0}});var p={url:u,type:a,data:k,timestamp:String((new Date).getTime())}}
var b=k(c);this.get=function(b,c){a("get",b,c)};this.post=function(b,c,d){a("post",b,c,d)};this.del=function(b,c){a("delete",b,c)};this["delete"]=this.del}});extole.define("http://origin.extole.io/type=core:clientId=1933045607:coreAssetsVersion=1499462991669/shared/js/user-service.js",[],function(){var m=this.async();extole.require(["http://origin.extole.io/type=core:clientId=1933045607:coreAssetsVersion=1499462991669/common/user-service.js"],function(u){m(u)})});
extole.define("http://origin.extole.io/type=core:clientId=1933045607:coreAssetsVersion=1499462991669/shared/js/api.js",[],function(){var m=this.async();extole.require(["http://origin.extole.io/type=core:clientId=1933045607:coreAssetsVersion=1499462991669/common/api.js"],function(u){m(u)})});